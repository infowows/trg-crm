{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\ninterface Connection {\r\n    isConnected: boolean;\r\n}\r\n\r\nconst connection: Connection = { isConnected: false };\r\n\r\nasync function dbConnect(): Promise<typeof mongoose> {\r\n    if (connection.isConnected) {\r\n        console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n        return mongoose;\r\n    }\r\n\r\n    try {\r\n        console.log(\"üì° Connecting to MongoDB...\");\r\n\r\n        const db = await mongoose.connect(process.env.MONGODB_URI!, {\r\n            bufferCommands: false,\r\n        });\r\n\r\n        connection.isConnected = db.connections[0].readyState === 1;\r\n\r\n        console.log(\"‚úÖ MongoDB connected successfully\");\r\n        console.log(\"üìä Database name:\", db.connection.name);\r\n\r\n        return db;\r\n    } catch (error) {\r\n        console.error(\"‚ùå MongoDB connection error:\", error);\r\n        connection.isConnected = false;\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAMA,MAAM,aAAyB;IAAE,aAAa;AAAM;AAEpD,eAAe;IACX,IAAI,WAAW,WAAW,EAAE;QACxB,QAAQ,GAAG,CAAC;QACZ,OAAO,mKAAQ;IACnB;IAEA,IAAI;QACA,QAAQ,GAAG,CAAC;QAEZ,MAAM,KAAK,MAAM,mKAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAG;YACxD,gBAAgB;QACpB;QAEA,WAAW,WAAW,GAAG,GAAG,WAAW,CAAC,EAAE,CAAC,UAAU,KAAK;QAE1D,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,qBAAqB,GAAG,UAAU,CAAC,IAAI;QAEnD,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,WAAW,WAAW,GAAG;QACzB,MAAM;IACV;AACJ;uCAEe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/models/ServicePricing.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface IServicePricing extends Document {\r\n    serviceGroupName: string;  // T√™n nh√≥m d·ªãch v·ª• (l∆∞u string ƒë·ªÉ xem ngay)\r\n    serviceName: string;       // T√™n d·ªãch v·ª•\r\n    packageName?: string;      // T√™n g√≥i (v√≠ d·ª•: \"G√≥i Cao C·∫•p\")\r\n    unitPrice: number;         // ƒê∆°n gi√° ƒë∆∞·ª£c thi·∫øt l·∫≠p t·∫°i ƒë√¢y\r\n    effectiveFrom: Date;       // Hi·ªáu l·ª±c t·ª´\r\n    effectiveTo?: Date;        // Hi·ªáu l·ª±c ƒë·∫øn\r\n    isActive: boolean;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nconst ServicePricingSchema: Schema = new Schema(\r\n    {\r\n        serviceGroupName: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        serviceName: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        packageName: {\r\n            type: String,\r\n            default: \"M·∫∑c ƒë·ªãnh\", // N·∫øu d·ªãch v·ª• kh√¥ng ph√¢n g√≥i\r\n            trim: true,\r\n        },\r\n        unitPrice: {\r\n            type: Number,\r\n            required: true,\r\n            min: 0,\r\n        },\r\n        effectiveFrom: {\r\n            type: Date,\r\n            required: true,\r\n            default: Date.now,\r\n        },\r\n        effectiveTo: {\r\n            type: Date,\r\n            default: null, // ƒê·ªÉ null n·∫øu ch∆∞a x√°c ƒë·ªãnh ng√†y k·∫øt th√∫c\r\n        },\r\n        isActive: {\r\n            type: Boolean,\r\n            default: true,\r\n        },\r\n    },\r\n    {\r\n        timestamps: true,\r\n        collection: \"C√†i ƒë·∫∑t gi√° g√≥i\",\r\n    },\r\n);\r\n\r\n// T·∫°o Index ƒë·ªÉ h·ªó tr·ª£ t√¨m ki·∫øm v√† s·∫Øp x·∫øp gi√° theo th·ªùi gian nhanh h∆°n\r\nServicePricingSchema.index({ serviceName: 1, effectiveFrom: -1 });\r\n\r\nexport default mongoose.models.ServicePricing ||\r\n    mongoose.model<IServicePricing>(\"ServicePricing\", ServicePricingSchema);"],"names":[],"mappings":";;;;AAAA;;AAcA,MAAM,uBAA+B,IAAI,kKAAM,CAC3C;IACI,kBAAkB;QACd,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,aAAa;QACT,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,aAAa;QACT,MAAM;QACN,SAAS;QACT,MAAM;IACV;IACA,WAAW;QACP,MAAM;QACN,UAAU;QACV,KAAK;IACT;IACA,eAAe;QACX,MAAM;QACN,UAAU;QACV,SAAS,KAAK,GAAG;IACrB;IACA,aAAa;QACT,MAAM;QACN,SAAS;IACb;IACA,UAAU;QACN,MAAM;QACN,SAAS;IACb;AACJ,GACA;IACI,YAAY;IACZ,YAAY;AAChB;AAGJ,uEAAuE;AACvE,qBAAqB,KAAK,CAAC;IAAE,aAAa;IAAG,eAAe,CAAC;AAAE;uCAEhD,mKAAQ,CAAC,MAAM,CAAC,cAAc,IACzC,mKAAQ,CAAC,KAAK,CAAkB,kBAAkB"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/app/api/service-pricing/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport dbConnect from \"../../../lib/dbConnect\";\r\nimport ServicePricing from \"../../../models/ServicePricing\";\r\n\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        await dbConnect();\r\n\r\n        const { searchParams } = new URL(request.url);\r\n        const page = parseInt(searchParams.get(\"page\") || \"1\");\r\n        const limit = parseInt(searchParams.get(\"limit\") || \"10\");\r\n        const active = searchParams.get(\"active\");\r\n        const serviceGroup = searchParams.get(\"serviceGroup\");\r\n\r\n        const query: any = {};\r\n        if (active !== null && active !== undefined) {\r\n            query.active = active === \"true\";\r\n        }\r\n        if (serviceGroup) {\r\n            query.serviceGroup = { $regex: serviceGroup, $options: \"i\" };\r\n        }\r\n\r\n        const skip = (page - 1) * limit;\r\n\r\n        const [data, total] = await Promise.all([\r\n            ServicePricing.find(query)\r\n                .sort({ createdAt: -1 })\r\n                .skip(skip)\r\n                .limit(limit),\r\n            ServicePricing.countDocuments(query),\r\n        ]);\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            data,\r\n            pagination: {\r\n                page,\r\n                limit,\r\n                total,\r\n                pages: Math.ceil(total / limit),\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error(\"Error fetching service pricing:\", error);\r\n        return NextResponse.json(\r\n            { success: false, error: \"Failed to fetch service pricing\" },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        await dbConnect();\r\n        const body = await request.json();\r\n\r\n        const servicePricing = new ServicePricing(body);\r\n        await servicePricing.save();\r\n\r\n        return NextResponse.json(\r\n            {\r\n                success: true,\r\n                data: servicePricing,\r\n            },\r\n            { status: 201 },\r\n        );\r\n    } catch (error: any) {\r\n        console.error(\"Error creating service pricing:\", error);\r\n\r\n        if (error.code === 11000) {\r\n            return NextResponse.json(\r\n                { success: false, error: \"Service pricing already exists\" },\r\n                { status: 400 },\r\n            );\r\n        }\r\n\r\n        return NextResponse.json(\r\n            { success: false, error: \"Failed to create service pricing\" },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,IAAA,6HAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,aAAa,GAAG,CAAC;QAChC,MAAM,eAAe,aAAa,GAAG,CAAC;QAEtC,MAAM,QAAa,CAAC;QACpB,IAAI,WAAW,QAAQ,WAAW,WAAW;YACzC,MAAM,MAAM,GAAG,WAAW;QAC9B;QACA,IAAI,cAAc;YACd,MAAM,YAAY,GAAG;gBAAE,QAAQ;gBAAc,UAAU;YAAI;QAC/D;QAEA,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,MAAM,CAAC,MAAM,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;YACpC,qIAAc,CAAC,IAAI,CAAC,OACf,IAAI,CAAC;gBAAE,WAAW,CAAC;YAAE,GACrB,IAAI,CAAC,MACL,KAAK,CAAC;YACX,qIAAc,CAAC,cAAc,CAAC;SACjC;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT;YACA,YAAY;gBACR;gBACA;gBACA;gBACA,OAAO,KAAK,IAAI,CAAC,QAAQ;YAC7B;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,mCAAmC;QACjD,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;YAAO,OAAO;QAAkC,GAC3D;YAAE,QAAQ;QAAI;IAEtB;AACJ;AAEO,eAAe,KAAK,OAAoB;IAC3C,IAAI;QACA,MAAM,IAAA,6HAAS;QACf,MAAM,OAAO,MAAM,QAAQ,IAAI;QAE/B,MAAM,iBAAiB,IAAI,qIAAc,CAAC;QAC1C,MAAM,eAAe,IAAI;QAEzB,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,MAAM;QACV,GACA;YAAE,QAAQ;QAAI;IAEtB,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,mCAAmC;QAEjD,IAAI,MAAM,IAAI,KAAK,OAAO;YACtB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBAAE,SAAS;gBAAO,OAAO;YAAiC,GAC1D;gBAAE,QAAQ;YAAI;QAEtB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;YAAO,OAAO;QAAmC,GAC5D;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}