{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\ninterface Connection {\r\n    isConnected: boolean;\r\n}\r\n\r\nconst connection: Connection = { isConnected: false };\r\n\r\nasync function dbConnect(): Promise<typeof mongoose> {\r\n    if (connection.isConnected) {\r\n        console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n        return mongoose;\r\n    }\r\n\r\n    try {\r\n        console.log(\"üì° Connecting to MongoDB...\");\r\n\r\n        const db = await mongoose.connect(process.env.MONGODB_URI!, {\r\n            bufferCommands: false,\r\n        });\r\n\r\n        connection.isConnected = db.connections[0].readyState === 1;\r\n\r\n        console.log(\"‚úÖ MongoDB connected successfully\");\r\n        console.log(\"üìä Database name:\", db.connection.name);\r\n\r\n        return db;\r\n    } catch (error) {\r\n        console.error(\"‚ùå MongoDB connection error:\", error);\r\n        connection.isConnected = false;\r\n        throw error;\r\n    }\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAMA,MAAM,aAAyB;IAAE,aAAa;AAAM;AAEpD,eAAe;IACX,IAAI,WAAW,WAAW,EAAE;QACxB,QAAQ,GAAG,CAAC;QACZ,OAAO,mKAAQ;IACnB;IAEA,IAAI;QACA,QAAQ,GAAG,CAAC;QAEZ,MAAM,KAAK,MAAM,mKAAQ,CAAC,OAAO,CAAC,QAAQ,GAAG,CAAC,WAAW,EAAG;YACxD,gBAAgB;QACpB;QAEA,WAAW,WAAW,GAAG,GAAG,WAAW,CAAC,EAAE,CAAC,UAAU,KAAK;QAE1D,QAAQ,GAAG,CAAC;QACZ,QAAQ,GAAG,CAAC,qBAAqB,GAAG,UAAU,CAAC,IAAI;QAEnD,OAAO;IACX,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,WAAW,WAAW,GAAG;QACzB,MAAM;IACV;AACJ;uCAEe"}},
    {"offset": {"line": 80, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/models/User.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface IUser extends Document {\r\n    username: string;\r\n    password: string;\r\n    fullName: string;\r\n    email?: string;\r\n    role: string;\r\n    active: boolean;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nconst UserSchema: Schema = new Schema(\r\n    {\r\n        username: {\r\n            type: String,\r\n            required: true,\r\n            unique: true,\r\n            trim: true,\r\n        },\r\n        password: {\r\n            type: String,\r\n            required: true,\r\n        },\r\n        fullName: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        email: {\r\n            type: String,\r\n            trim: true,\r\n            lowercase: true,\r\n        },\r\n        role: {\r\n            type: String,\r\n            required: true,\r\n            default: \"user\",\r\n        },\r\n        active: {\r\n            type: Boolean,\r\n            default: true,\r\n        },\r\n    },\r\n    {\r\n        timestamps: true,\r\n        collection: \"users\",\r\n    },\r\n);\r\n\r\nexport default mongoose.models.User ||\r\n    mongoose.model<IUser>(\"User\", UserSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAaA,MAAM,aAAqB,IAAI,kKAAM,CACjC;IACI,UAAU;QACN,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;IACV;IACA,UAAU;QACN,MAAM;QACN,UAAU;IACd;IACA,UAAU;QACN,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,OAAO;QACH,MAAM;QACN,MAAM;QACN,WAAW;IACf;IACA,MAAM;QACF,MAAM;QACN,UAAU;QACV,SAAS;IACb;IACA,QAAQ;QACJ,MAAM;QACN,SAAS;IACb;AACJ,GACA;IACI,YAAY;IACZ,YAAY;AAChB;uCAGW,mKAAQ,CAAC,MAAM,CAAC,IAAI,IAC/B,mKAAQ,CAAC,KAAK,CAAQ,QAAQ"}},
    {"offset": {"line": 125, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/app/api/create-admin/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport dbConnect from \"../../../lib/dbConnect\";\r\nimport User from \"../../../models/User\";\r\n\r\nexport async function POST() {\r\n    try {\r\n        await dbConnect();\r\n        console.log(\"üîÑ Creating admin user...\");\r\n\r\n        // Check if admin already exists\r\n        const existingAdmin = await User.findOne({ username: \"admin\" });\r\n        if (existingAdmin) {\r\n            return NextResponse.json(\r\n                {\r\n                    success: false,\r\n                    message: \"Admin user already exists\",\r\n                },\r\n                { status: 400 },\r\n            );\r\n        }\r\n\r\n        // Create admin user\r\n        const admin = new User({\r\n            username: \"admin\",\r\n            password: \"admin123\", // Plain text as per backend logic\r\n            fullName: \"Administrator\",\r\n            email: \"admin@trgcrm.com\",\r\n            role: \"admin\",\r\n            active: true,\r\n        });\r\n\r\n        await admin.save();\r\n        console.log(\"‚úÖ Admin user created successfully\");\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: \"Admin user created successfully\",\r\n            data: {\r\n                username: \"admin\",\r\n                password: \"admin123\",\r\n                fullName: \"Administrator\",\r\n            },\r\n        });\r\n    } catch (error: any) {\r\n        console.error(\"‚ùå Error creating admin user:\", error);\r\n\r\n        if (error.code === 11000) {\r\n            return NextResponse.json(\r\n                {\r\n                    success: false,\r\n                    message: \"Admin user already exists\",\r\n                },\r\n                { status: 400 },\r\n            );\r\n        }\r\n\r\n        return NextResponse.json(\r\n            {\r\n                success: false,\r\n                error: \"Failed to create admin user\",\r\n            },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,IAAA,6HAAS;QACf,QAAQ,GAAG,CAAC;QAEZ,gCAAgC;QAChC,MAAM,gBAAgB,MAAM,2HAAI,CAAC,OAAO,CAAC;YAAE,UAAU;QAAQ;QAC7D,IAAI,eAAe;YACf,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,SAAS;YACb,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,oBAAoB;QACpB,MAAM,QAAQ,IAAI,2HAAI,CAAC;YACnB,UAAU;YACV,UAAU;YACV,UAAU;YACV,OAAO;YACP,MAAM;YACN,QAAQ;QACZ;QAEA,MAAM,MAAM,IAAI;QAChB,QAAQ,GAAG,CAAC;QAEZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,SAAS;YACT,MAAM;gBACF,UAAU;gBACV,UAAU;gBACV,UAAU;YACd;QACJ;IACJ,EAAE,OAAO,OAAY;QACjB,QAAQ,KAAK,CAAC,gCAAgC;QAE9C,IAAI,MAAM,IAAI,KAAK,OAAO;YACtB,OAAO,gJAAY,CAAC,IAAI,CACpB;gBACI,SAAS;gBACT,SAAS;YACb,GACA;gBAAE,QAAQ;YAAI;QAEtB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACpB;YACI,SAAS;YACT,OAAO;QACX,GACA;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}