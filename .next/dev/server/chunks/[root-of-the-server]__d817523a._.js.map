{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI!;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\",\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    // console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    console.log(\"üì° Connecting to MongoDB...\");\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      console.log(\"‚úÖ MongoDB connected successfully\");\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    console.error(\"‚ùå MongoDB connection error:\", e);\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,uDAAuD;QACvD,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/Position.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst positionSchema = new mongoose.Schema(\r\n    {\r\n        positionName: { type: String, required: true },\r\n        description: { type: String },\r\n        department: { type: String },\r\n        isActive: { type: Boolean, default: true },\r\n        createdAt: { type: Date, default: Date.now },\r\n        updatedAt: { type: Date, default: Date.now },\r\n    },\r\n    { collection: \"Ch·ª©c v·ª•\" },\r\n);\r\n\r\nconst Position =\r\n    mongoose.models.ChucVu || mongoose.model(\"ChucVu\", positionSchema);\r\nexport default Position;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,iBAAiB,IAAI,mKAAQ,CAAC,MAAM,CACtC;IACI,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,aAAa;QAAE,MAAM;IAAO;IAC5B,YAAY;QAAE,MAAM;IAAO;IAC3B,UAAU;QAAE,MAAM;QAAS,SAAS;IAAK;IACzC,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC3C,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC/C,GACA;IAAE,YAAY;AAAU;AAG5B,MAAM,WACF,mKAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,mKAAQ,CAAC,KAAK,CAAC,UAAU;uCACxC"}},
    {"offset": {"line": 158, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/lib/auth.ts"],"sourcesContent":["import jwt from \"jsonwebtoken\";\r\nimport bcrypt from \"bcryptjs\";\r\n\r\nconst JWT_SECRET = process.env.JWT_SECRET || \"your-secret-key\";\r\n\r\nexport interface JWTPayload {\r\n    id: string;\r\n    username: string;\r\n    email: string;\r\n    ho_ten: string;\r\n    phong_ban: string;\r\n    chuc_vu: string;\r\n    phan_quyen: string;\r\n}\r\n\r\nexport function generateToken(payload: JWTPayload): string {\r\n    return jwt.sign(payload, JWT_SECRET, { expiresIn: \"7d\" });\r\n}\r\n\r\nexport function verifyToken(token: string): JWTPayload | null {\r\n    try {\r\n        return jwt.verify(token, JWT_SECRET) as JWTPayload;\r\n    } catch (error) {\r\n        return null;\r\n    }\r\n}\r\n\r\nexport async function hashPassword(password: string): Promise<string> {\r\n    return bcrypt.hash(password, 12);\r\n}\r\n\r\nexport async function comparePassword(\r\n    password: string,\r\n    hashedPassword: string,\r\n): Promise<boolean> {\r\n    return bcrypt.compare(password, hashedPassword);\r\n}\r\n"],"names":[],"mappings":";;;;;;;;;;AAAA;AACA;;;AAEA,MAAM,aAAa,QAAQ,GAAG,CAAC,UAAU,IAAI;AAYtC,SAAS,cAAc,OAAmB;IAC7C,OAAO,kJAAG,CAAC,IAAI,CAAC,SAAS,YAAY;QAAE,WAAW;IAAK;AAC3D;AAEO,SAAS,YAAY,KAAa;IACrC,IAAI;QACA,OAAO,kJAAG,CAAC,MAAM,CAAC,OAAO;IAC7B,EAAE,OAAO,OAAO;QACZ,OAAO;IACX;AACJ;AAEO,eAAe,aAAa,QAAgB;IAC/C,OAAO,8IAAM,CAAC,IAAI,CAAC,UAAU;AACjC;AAEO,eAAe,gBAClB,QAAgB,EAChB,cAAsB;IAEtB,OAAO,8IAAM,CAAC,OAAO,CAAC,UAAU;AACpC"}},
    {"offset": {"line": 195, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/app/api/positions/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport dbConnect from \"../../../lib/dbConnect\";\r\nimport Position from \"../../../models/Position\";\r\nimport { verifyToken } from \"../../../lib/auth\";\r\nimport mongoose from \"mongoose\";\r\n\r\n// Helper function to verify authentication\r\nasync function verifyAuth(request: NextRequest) {\r\n    const token = request.cookies.get(\"token\")?.value;\r\n    if (!token) return null;\r\n\r\n    const decoded = verifyToken(token);\r\n    if (!decoded) return null;\r\n\r\n    return decoded;\r\n}\r\n\r\n// GET - L·∫•y danh s√°ch ch·ª©c v·ª•\r\nexport async function GET(request: NextRequest) {\r\n    try {\r\n        const auth = await verifyAuth(request);\r\n        if (!auth) {\r\n            return NextResponse.json(\r\n                { success: false, message: \"Kh√¥ng ƒë∆∞·ª£c ph√©p truy c·∫≠p\" },\r\n                { status: 401 },\r\n            );\r\n        }\r\n\r\n        await dbConnect();\r\n        await mongoose.connection.db;\r\n\r\n        const { searchParams } = new URL(request.url);\r\n        const page = parseInt(searchParams.get(\"page\") || \"1\");\r\n        const limit = parseInt(searchParams.get(\"limit\") || \"10\");\r\n        const search = searchParams.get(\"search\") || \"\";\r\n        const isActive = searchParams.get(\"isActive\");\r\n        const department = searchParams.get(\"department\");\r\n\r\n        const query: any = {};\r\n\r\n        if (search) {\r\n            query.$or = [\r\n                { positionName: { $regex: search, $options: \"i\" } },\r\n                { description: { $regex: search, $options: \"i\" } },\r\n                { department: { $regex: search, $options: \"i\" } },\r\n            ];\r\n        }\r\n\r\n        if (isActive !== null && isActive !== undefined) {\r\n            query.isActive = isActive === \"true\";\r\n        }\r\n\r\n        if (department) {\r\n            query.department = department;\r\n        }\r\n\r\n        const skip = (page - 1) * limit;\r\n\r\n        const [positions, total] = await Promise.all([\r\n            Position.find(query)\r\n                .sort({ createdAt: -1 })\r\n                .skip(skip)\r\n                .limit(limit),\r\n            Position.countDocuments(query),\r\n        ]);\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            data: positions,\r\n            pagination: {\r\n                page,\r\n                limit,\r\n                total,\r\n                pages: Math.ceil(total / limit),\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error(\"GET positions error:\", error);\r\n        return NextResponse.json(\r\n            { success: false, message: \"C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.\" },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n\r\n// POST - Th√™m ch·ª©c v·ª• m·ªõi\r\nexport async function POST(request: NextRequest) {\r\n    try {\r\n        const auth = await verifyAuth(request);\r\n        if (!auth) {\r\n            return NextResponse.json(\r\n                { success: false, message: \"Kh√¥ng ƒë∆∞·ª£c ph√©p truy c·∫≠p\" },\r\n                { status: 401 },\r\n            );\r\n        }\r\n\r\n        await dbConnect();\r\n        await mongoose.connection.db;\r\n\r\n        const body = await request.json();\r\n        const { positionName, description, department } = body;\r\n\r\n        if (!positionName) {\r\n            return NextResponse.json(\r\n                { success: false, message: \"Vui l√≤ng nh·∫≠p t√™n ch·ª©c v·ª•\" },\r\n                { status: 400 },\r\n            );\r\n        }\r\n\r\n        const position = new Position({\r\n            positionName,\r\n            description,\r\n            department,\r\n            isActive: true,\r\n            createdAt: new Date(),\r\n            updatedAt: new Date(),\r\n        });\r\n\r\n        await position.save();\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            message: \"Th√™m ch·ª©c v·ª• th√†nh c√¥ng\",\r\n            data: position,\r\n        });\r\n    } catch (error) {\r\n        console.error(\"POST position error:\", error);\r\n        return NextResponse.json(\r\n            { success: false, message: \"C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i.\" },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}}]
}