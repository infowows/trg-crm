{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_DEV/TruongGiang_CRM/TruongGiang_CRM_NextJS/trg-crm-webapp/app/%28dashboard%29/khach-hang/tao-moi/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React, { useState, useEffect, useRef } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport mapboxgl from \"mapbox-gl\";\r\nimport {\r\n    User,\r\n    ArrowLeft,\r\n    Building,\r\n    MapPin,\r\n    Phone,\r\n    Mail,\r\n    Globe,\r\n    Users,\r\n    Target,\r\n    TrendingUp,\r\n    Star,\r\n    Clock,\r\n    CheckCircle,\r\n    AlertCircle,\r\n    Loader2,\r\n    ImageIcon,\r\n    Upload,\r\n    X,\r\n    Calendar,\r\n    Save,\r\n} from \"lucide-react\";\r\n\r\ninterface CustomerFormData {\r\n    fullName: string;\r\n    shortName: string;\r\n    address: string;\r\n    phone: string;\r\n    image: string;\r\n    source: string;\r\n    referrer: string;\r\n    referrerPhone: string;\r\n    serviceGroup: string;\r\n    marketingClassification: string;\r\n    potentialLevel: string;\r\n    salesPerson: string;\r\n    needsNote: string;\r\n    isActive: boolean;\r\n    lat: number;\r\n    lng: number;\r\n}\r\n\r\nconst CreateCustomer = () => {\r\n    const router = useRouter();\r\n    const [loading, setLoading] = useState(false);\r\n    const [error, setError] = useState<string | null>(null);\r\n    const [success, setSuccess] = useState<string | null>(null);\r\n    const [uploadingImage, setUploadingImage] = useState(false);\r\n    const [salesPersons, setSalesPersons] = useState<\r\n        Array<{ _id: string; fullName: string; position: string }>\r\n    >([]);\r\n    const [serviceGroups, setServiceGroups] = useState<\r\n        Array<{ _id: string; name: string }>\r\n    >([]);\r\n\r\n    // Mapbox state\r\n    const mapRef = useRef<mapboxgl.Map | null>(null);\r\n    const [mapCenter, setMapCenter] = useState({ lat: 21.0285, lng: 105.8542 }); // Default: Hanoi\r\n    const [showMap, setShowMap] = useState(false);\r\n    const [searchResults, setSearchResults] = useState<\r\n        Array<{ display_name: string; lat: string; lon: string }>\r\n    >([]);\r\n    const [isSearching, setIsSearching] = useState(false);\r\n    const [showSuggestions, setShowSuggestions] = useState(false);\r\n    const [selectedIndex, setSelectedIndex] = useState(-1);\r\n    const searchTimeoutRef = useRef<NodeJS.Timeout | null>(null);\r\n\r\n    const [formData, setFormData] = useState<CustomerFormData>({\r\n        fullName: \"\",\r\n        shortName: \"\",\r\n        address: \"\",\r\n        phone: \"\",\r\n        image: \"\",\r\n        source: \"\",\r\n        referrer: \"\",\r\n        referrerPhone: \"\",\r\n        serviceGroup: \"\",\r\n        marketingClassification: \"\",\r\n        potentialLevel: \"Trung bình\",\r\n        salesPerson: \"\",\r\n        needsNote: \"\",\r\n        isActive: true,\r\n        lat: 0,\r\n        lng: 0,\r\n    });\r\n\r\n    // Fetch sales persons and service groups\r\n    useEffect(() => {\r\n        const fetchData = async () => {\r\n            try {\r\n                const token = localStorage.getItem(\"token\");\r\n                if (!token) {\r\n                    router.push(\"/login\");\r\n                    return;\r\n                }\r\n\r\n                // Fetch sales persons\r\n                const salesResponse = await fetch(\"/api/employees\", {\r\n                    headers: {\r\n                        Authorization: `Bearer ${token}`,\r\n                    },\r\n                });\r\n\r\n                // Fetch service groups\r\n                const serviceGroupsResponse = await fetch(\r\n                    \"/api/service-groups\",\r\n                    {\r\n                        headers: {\r\n                            Authorization: `Bearer ${token}`,\r\n                        },\r\n                    },\r\n                );\r\n\r\n                if (salesResponse.ok) {\r\n                    const salesData = await salesResponse.json();\r\n                    if (salesData.success) {\r\n                        setSalesPersons(salesData.data);\r\n                    }\r\n                    console.log(\"data:\", salesData.data);\r\n                }\r\n\r\n                if (serviceGroupsResponse.ok) {\r\n                    const serviceGroupsData =\r\n                        await serviceGroupsResponse.json();\r\n                    setServiceGroups(serviceGroupsData.data || []);\r\n                    // console.log(\"data:\", serviceGroupsData.data);\r\n                }\r\n            } catch (err) {\r\n                console.error(\"Error fetching data:\", err);\r\n            }\r\n        };\r\n\r\n        fetchData();\r\n    }, [router]);\r\n\r\n    // Cleanup timeout on unmount\r\n    useEffect(() => {\r\n        return () => {\r\n            if (searchTimeoutRef.current) {\r\n                clearTimeout(searchTimeoutRef.current);\r\n            }\r\n        };\r\n    }, []);\r\n\r\n    // Initialize Mapbox map when showMap changes\r\n    useEffect(() => {\r\n        if (showMap && typeof window !== \"undefined\") {\r\n            // Set access token\r\n            mapboxgl.accessToken =\r\n                \"pk.eyJ1IjoidG9uMDkxNjQiLCJhIjoiY21rdzIyb2h0MGUxcTNjcTBjdGwwZWVjcCJ9.XvgoEicoaAllA1h_j6m0PA\";\r\n\r\n            // Initialize map if not already initialized\r\n            if (!mapRef.current) {\r\n                const map = new mapboxgl.Map({\r\n                    container: \"mapbox-map\",\r\n                    style: \"mapbox://styles/mapbox/streets-v11\",\r\n                    center: [mapCenter.lng, mapCenter.lat],\r\n                    zoom: 15,\r\n                });\r\n\r\n                // Add click handler\r\n                map.on(\"click\", (e: any) => {\r\n                    handleMapClick(e.lngLat.lat, e.lngLat.lng);\r\n                });\r\n\r\n                mapRef.current = map;\r\n            } else {\r\n                // Update existing map center\r\n                mapRef.current.setCenter([mapCenter.lng, mapCenter.lat]);\r\n                mapRef.current.setZoom(15);\r\n            }\r\n\r\n            // Update marker\r\n            if (mapRef.current) {\r\n                // Remove existing markers\r\n                const markers =\r\n                    document.getElementsByClassName(\"mapboxgl-marker\");\r\n                while (markers.length > 0) {\r\n                    markers[0].remove();\r\n                }\r\n\r\n                // Add new marker if coordinates exist\r\n                if (formData.lat !== 0 && formData.lng !== 0) {\r\n                    new mapboxgl.Marker()\r\n                        .setLngLat([formData.lng, formData.lat])\r\n                        .addTo(mapRef.current);\r\n                }\r\n            }\r\n        }\r\n    }, [showMap, mapCenter, formData.lat, formData.lng]);\r\n\r\n    // Address search handlers\r\n    const handleAddressSearch = async (query: string) => {\r\n        if (query.length < 3) {\r\n            setSearchResults([]);\r\n            setShowSuggestions(false);\r\n            return;\r\n        }\r\n\r\n        // Clear previous timeout\r\n        if (searchTimeoutRef.current) {\r\n            clearTimeout(searchTimeoutRef.current);\r\n        }\r\n\r\n        // Set new timeout for debouncing (2 seconds - faster UX)\r\n        searchTimeoutRef.current = setTimeout(async () => {\r\n            setIsSearching(true);\r\n            setShowSuggestions(true);\r\n            setSelectedIndex(-1);\r\n\r\n            try {\r\n                // Tối ưu query cho Việt Nam - tập trung vào query gốc trước\r\n                let searchQueries = [];\r\n\r\n                // Query gốc (quan trọng nhất)\r\n                const baseQuery = query.toLowerCase().includes(\"việt nam\")\r\n                    ? query\r\n                    : `${query}, Việt Nam`;\r\n                searchQueries.push(baseQuery);\r\n\r\n                // Nếu query đã có các thành phố lớn, không thêm nữa\r\n                const hasMajorCity = query\r\n                    .toLowerCase()\r\n                    .match(/(hà nội|ho chi minh|tp\\.hcm|da nang|hanoi|saigon)/);\r\n\r\n                // Chỉ thêm các thành phố lớn nếu query không có cụ thể\r\n                if (\r\n                    !hasMajorCity &&\r\n                    !query.toLowerCase().includes(\"quận\") &&\r\n                    !query.toLowerCase().includes(\"phường\")\r\n                ) {\r\n                    searchQueries.push(`${query}, TP.HCM, Việt Nam`);\r\n                    searchQueries.push(`${query}, Hà Nội, Việt Nam`);\r\n                    searchQueries.push(`${query}, Đà Nẵng, Việt Nam`);\r\n                }\r\n\r\n                // Nếu là địa chỉ cụ thể (có số nhà), thêm các quận/phường phổ biến\r\n                if (query.match(/^\\d+/)) {\r\n                    // Ưu tiên các quận trung tâm của TP.HCM\r\n                    searchQueries.push(`${query}, Quận 1, TP.HCM, Việt Nam`);\r\n                    searchQueries.push(`${query}, Quận 3, TP.HCM, Việt Nam`);\r\n                    searchQueries.push(`${query}, Quận 5, TP.HCM, Việt Nam`);\r\n                    searchQueries.push(`${query}, Quận 10, TP.HCM, Việt Nam`);\r\n                    searchQueries.push(`${query}, Phú Nhuận, TP.HCM, Việt Nam`);\r\n\r\n                    // Ưu tiên các quận trung tâm của Hà Nội\r\n                    searchQueries.push(`${query}, Hoàn Kiếm, Hà Nội, Việt Nam`);\r\n                    searchQueries.push(`${query}, Ba Đình, Hà Nội, Việt Nam`);\r\n                    searchQueries.push(`${query}, Đống Đa, Hà Nội, Việt Nam`);\r\n                    searchQueries.push(\r\n                        `${query}, Hai Bà Trưng, Hà Nội, Việt Nam`,\r\n                    );\r\n                }\r\n\r\n                let allResults: Array<{\r\n                    display_name: string;\r\n                    lat: string;\r\n                    lon: string;\r\n                }> = [];\r\n\r\n                // Thử từng query cho đến khi có kết quả\r\n                for (const searchQuery of searchQueries) {\r\n                    if (allResults.length >= 5) break; // Giới hạn 5 kết quả\r\n\r\n                    const maxRetries = 2;\r\n                    let retryCount = 0;\r\n                    let data = null;\r\n\r\n                    while (retryCount < maxRetries && !data) {\r\n                        try {\r\n                            const response = await fetch(\r\n                                `https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(\r\n                                    searchQuery,\r\n                                )}&countrycodes=VN&limit=${5 - allResults.length}`,\r\n                                {\r\n                                    headers: {\r\n                                        \"User-Agent\": \"CRM-App/1.0\",\r\n                                        Accept: \"application/json\",\r\n                                    },\r\n                                },\r\n                            );\r\n\r\n                            if (response.ok) {\r\n                                data = await response.json();\r\n                                if (data && data.length > 0) {\r\n                                    // Loại bỏ trùng lặp\r\n                                    const newResults = data.filter(\r\n                                        (item: any) =>\r\n                                            !allResults.some(\r\n                                                (existing) =>\r\n                                                    existing.display_name ===\r\n                                                    item.display_name,\r\n                                            ),\r\n                                    );\r\n                                    allResults = [...allResults, ...newResults];\r\n\r\n                                    // Nếu query gốc có kết quả, ưu tiên và break early\r\n                                    if (\r\n                                        searchQuery === baseQuery &&\r\n                                        newResults.length > 0\r\n                                    ) {\r\n                                        break;\r\n                                    }\r\n                                }\r\n                            } else if (response.status === 429) {\r\n                                await new Promise((resolve) =>\r\n                                    setTimeout(\r\n                                        resolve,\r\n                                        1000 * (retryCount + 1),\r\n                                    ),\r\n                                );\r\n                            }\r\n                        } catch (error) {\r\n                            console.warn(\r\n                                `Search attempt ${retryCount + 1} failed for query: ${searchQuery}`,\r\n                                error,\r\n                            );\r\n                            if (retryCount < maxRetries - 1) {\r\n                                await new Promise((resolve) =>\r\n                                    setTimeout(resolve, 500 * (retryCount + 1)),\r\n                                );\r\n                            }\r\n                        }\r\n                        retryCount++;\r\n                    }\r\n\r\n                    // Nếu đã có kết quả tốt từ query gốc, break\r\n                    if (allResults.length > 0 && searchQuery === baseQuery) {\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                // Sắp xếp kết quả: ưu tiên kết quả có nhiều chi tiết hơn và match query gốc\r\n                allResults.sort((a, b) => {\r\n                    // Ưu tiên kết quả chứa query gốc\r\n                    const aContainsQuery = a.display_name\r\n                        .toLowerCase()\r\n                        .includes(query.toLowerCase());\r\n                    const bContainsQuery = b.display_name\r\n                        .toLowerCase()\r\n                        .includes(query.toLowerCase());\r\n\r\n                    if (aContainsQuery && !bContainsQuery) return -1;\r\n                    if (!aContainsQuery && bContainsQuery) return 1;\r\n\r\n                    // Sau đó ưu tiên kết quả chi tiết hơn\r\n                    const aScore = a.display_name.split(\",\").length;\r\n                    const bScore = b.display_name.split(\",\").length;\r\n                    return bScore - aScore;\r\n                });\r\n\r\n                setSearchResults(allResults.slice(0, 5));\r\n            } catch (error) {\r\n                console.error(\"Error searching address:\", error);\r\n                setSearchResults([]);\r\n            } finally {\r\n                setIsSearching(false);\r\n            }\r\n        }, 2000); // Giảm xuống 2 giây để UX tốt hơn\r\n    };\r\n\r\n    const selectAddress = (place: {\r\n        display_name: string;\r\n        lat: string;\r\n        lon: string;\r\n    }) => {\r\n        const lat = parseFloat(place.lat);\r\n        const lng = parseFloat(place.lon);\r\n\r\n        setFormData((prev) => ({\r\n            ...prev,\r\n            address: place.display_name,\r\n            lat,\r\n            lng,\r\n        }));\r\n\r\n        setMapCenter({ lat, lng });\r\n        setSearchResults([]);\r\n        setShowSuggestions(false);\r\n        setSelectedIndex(-1);\r\n        setShowMap(true);\r\n    };\r\n\r\n    // Keyboard navigation\r\n    const handleKeyDown = (e: React.KeyboardEvent) => {\r\n        if (!showSuggestions || searchResults.length === 0) return;\r\n\r\n        switch (e.key) {\r\n            case \"ArrowDown\":\r\n                e.preventDefault();\r\n                setSelectedIndex((prev) =>\r\n                    prev < searchResults.length - 1 ? prev + 1 : prev,\r\n                );\r\n                break;\r\n            case \"ArrowUp\":\r\n                e.preventDefault();\r\n                setSelectedIndex((prev) => (prev > 0 ? prev - 1 : -1));\r\n                break;\r\n            case \"Enter\":\r\n                e.preventDefault();\r\n                if (\r\n                    selectedIndex >= 0 &&\r\n                    selectedIndex < searchResults.length\r\n                ) {\r\n                    selectAddress(searchResults[selectedIndex]);\r\n                }\r\n                break;\r\n            case \"Escape\":\r\n                setShowSuggestions(false);\r\n                setSelectedIndex(-1);\r\n                break;\r\n        }\r\n    };\r\n\r\n    // Handle input changes\r\n    const handleAddressInputChange = (\r\n        e: React.ChangeEvent<HTMLInputElement>,\r\n    ) => {\r\n        const value = e.target.value;\r\n        setFormData((prev) => ({ ...prev, address: value }));\r\n        handleAddressSearch(value);\r\n    };\r\n\r\n    const handleMapClick = (lat: number, lng: number) => {\r\n        setFormData((prev) => ({\r\n            ...prev,\r\n            lat,\r\n            lng,\r\n        }));\r\n\r\n        setMapCenter({ lat, lng });\r\n\r\n        // Reverse geocoding using Mapbox API\r\n        fetch(\r\n            `https://api.mapbox.com/geocoding/v5/mapbox.places/${lng},${lat}.json?access_token=pk.eyJ1IjoidG9uMDkxNjQiLCJhIjoiY21rdzIyb2h0MGUxcTNjcTBjdGwwZWVjcCJ9.XvgoEicoaAllA1h_j6m0PA&language=vi`,\r\n        )\r\n            .then((response) => response.json())\r\n            .then((data) => {\r\n                if (data && data.features && data.features.length > 0) {\r\n                    const placeName =\r\n                        data.features[0].place_name_vi ||\r\n                        data.features[0].place_name;\r\n                    setFormData((prev) => ({\r\n                        ...prev,\r\n                        address: placeName,\r\n                    }));\r\n                }\r\n            })\r\n            .catch((error) => {\r\n                console.error(\"Error reverse geocoding:\", error);\r\n            });\r\n    };\r\n\r\n    // Handle image upload to Cloudinary\r\n    const handleImageUpload = async (\r\n        e: React.ChangeEvent<HTMLInputElement>,\r\n    ) => {\r\n        const file = e.target.files?.[0];\r\n        if (!file) return;\r\n\r\n        // Validate file type\r\n        if (!file.type.startsWith(\"image/\")) {\r\n            setError(\"Vui lòng chọn file ảnh\");\r\n            return;\r\n        }\r\n\r\n        // Validate file size (max 5MB)\r\n        if (file.size > 5 * 1024 * 1024) {\r\n            setError(\"Kích thước ảnh không được vượt quá 5MB\");\r\n            return;\r\n        }\r\n\r\n        setUploadingImage(true);\r\n        setError(null);\r\n\r\n        try {\r\n            const formData = new FormData();\r\n            formData.append(\"file\", file);\r\n            formData.append(\"upload_preset\", \"ton-cloudinary\");\r\n\r\n            const response = await fetch(\r\n                `https://api.cloudinary.com/v1_1/dprxrbz1z/image/upload`,\r\n                {\r\n                    method: \"POST\",\r\n                    body: formData,\r\n                },\r\n            );\r\n\r\n            if (!response.ok) {\r\n                throw new Error(\"Upload ảnh thất bại\");\r\n            }\r\n\r\n            const data = await response.json();\r\n\r\n            // Update form with image URL\r\n            setFormData((prev) => ({\r\n                ...prev,\r\n                image: data.secure_url,\r\n            }));\r\n        } catch (err) {\r\n            console.error(\"Error uploading image:\", err);\r\n            setError(\"Không thể tải ảnh lên. Vui lòng thử lại.\");\r\n        } finally {\r\n            setUploadingImage(false);\r\n        }\r\n    };\r\n\r\n    // Parse Google Maps URL to extract coordinates\r\n    const parseGoogleMapsUrl = async (url: string) => {\r\n        try {\r\n            console.log(\"Parsing URL:\", url);\r\n\r\n            // Handle iframe embed code\r\n            if (url.includes(\"<iframe\")) {\r\n                const srcMatch = url.match(/src=\"([^\"]+)\"/);\r\n                if (srcMatch) {\r\n                    url = srcMatch[1];\r\n                    console.log(\"Extracted URL from iframe:\", url);\r\n                }\r\n            }\r\n\r\n            // Handle short URLs using server-side proxy\r\n            let finalUrl = url;\r\n            if (url.includes(\"maps.app.goo.gl\")) {\r\n                try {\r\n                    console.log(\"Resolving short URL via proxy...\");\r\n                    const response = await fetch(\"/api/resolve-maps-url\", {\r\n                        method: \"POST\",\r\n                        headers: {\r\n                            \"Content-Type\": \"application/json\",\r\n                        },\r\n                        body: JSON.stringify({ url }),\r\n                    });\r\n\r\n                    if (response.ok) {\r\n                        const data = await response.json();\r\n                        if (data.finalUrl) {\r\n                            finalUrl = data.finalUrl;\r\n                            console.log(\"Redirected to:\", finalUrl);\r\n                        }\r\n                    }\r\n                } catch (e) {\r\n                    console.log(\"Could not resolve short URL via proxy:\", e);\r\n                }\r\n            }\r\n\r\n            console.log(\"Final URL to parse:\", finalUrl);\r\n\r\n            // Parse coordinates from different formats\r\n            const patterns = [\r\n                /@(-?\\d+\\.\\d+),(-?\\d+\\.\\d+)/, // @lat,lng\r\n                /!3d(-?\\d+\\.\\d+)!4d(-?\\d+\\.\\d+)/, // !3dlat!4dlng (embed)\r\n                /(-?\\d+\\.\\d+),(-?\\d+\\.\\d+)/, // Any coordinate pattern\r\n            ];\r\n\r\n            for (const pattern of patterns) {\r\n                const match = finalUrl.match(pattern);\r\n                if (match) {\r\n                    console.log(\"Found coordinates:\", match);\r\n                    return {\r\n                        lat: parseFloat(match[1]),\r\n                        lng: parseFloat(match[2]),\r\n                    };\r\n                }\r\n            }\r\n\r\n            console.log(\"No coordinates found\");\r\n            return null;\r\n        } catch (error) {\r\n            console.error(\"Error parsing Google Maps URL:\", error);\r\n            return null;\r\n        }\r\n    };\r\n\r\n    // Handle Google Maps URL input\r\n    const handleGoogleMapsUrl = async (url: string) => {\r\n        if (!url) return;\r\n\r\n        setIsSearching(true);\r\n        setError(null);\r\n\r\n        try {\r\n            console.log(\"Processing Google Maps URL:\", url);\r\n            const coords = await parseGoogleMapsUrl(url);\r\n\r\n            if (coords) {\r\n                console.log(\"Successfully parsed coordinates:\", coords);\r\n\r\n                setFormData((prev) => ({\r\n                    ...prev,\r\n                    lat: coords.lat,\r\n                    lng: coords.lng,\r\n                }));\r\n\r\n                setMapCenter({ lat: coords.lat, lng: coords.lng });\r\n                setShowMap(true);\r\n\r\n                // Reverse geocoding using Mapbox API\r\n                const response = await fetch(\r\n                    `https://api.mapbox.com/geocoding/v5/mapbox.places/${coords.lng},${coords.lat}.json?access_token=pk.eyJ1IjoidG9uMDkxNjQiLCJhIjoiY21rdzIyb2h0MGUxcTNjcTBjdGwwZWVjcCJ9.XvgoEicoaAllA1h_j6m0PA&language=vi`,\r\n                );\r\n\r\n                if (response.ok) {\r\n                    const data = await response.json();\r\n                    if (data && data.features && data.features.length > 0) {\r\n                        const placeName =\r\n                            data.features[0].place_name_vi ||\r\n                            data.features[0].place_name;\r\n                        console.log(\"Reverse geocoding successful:\", placeName);\r\n                        setFormData((prev) => ({\r\n                            ...prev,\r\n                            address: placeName,\r\n                        }));\r\n                    } else {\r\n                        setFormData((prev) => ({\r\n                            ...prev,\r\n                            address: `Tọa độ: ${coords.lat}, ${coords.lng}`,\r\n                        }));\r\n                    }\r\n                }\r\n            } else {\r\n                setError(\r\n                    \"Không thể lấy tọa độ từ đường dẫn Google Maps. Vui lòng kiểm tra lại URL.\",\r\n                );\r\n            }\r\n        } catch (error) {\r\n            console.error(\"Error processing Google Maps URL:\", error);\r\n            setError(\"Có lỗi xảy ra khi xử lý đường dẫn Google Maps.\");\r\n        } finally {\r\n            setIsSearching(false);\r\n        }\r\n    };\r\n\r\n    // Handle form input changes\r\n    const handleInputChange = (\r\n        e: React.ChangeEvent<\r\n            HTMLInputElement | HTMLTextAreaElement | HTMLSelectElement\r\n        >,\r\n    ) => {\r\n        const { name, value, type } = e.target;\r\n\r\n        if (type === \"checkbox\") {\r\n            const checked = (e.target as HTMLInputElement).checked;\r\n            setFormData((prev) => ({\r\n                ...prev,\r\n                [name]: checked,\r\n            }));\r\n        } else {\r\n            setFormData((prev) => ({\r\n                ...prev,\r\n                [name]: value,\r\n            }));\r\n        }\r\n    };\r\n\r\n    // Validate form\r\n    const validateForm = () => {\r\n        if (!formData.fullName.trim()) {\r\n            setError(\"Vui lòng nhập tên đầy đủ của khách hàng\");\r\n            return false;\r\n        }\r\n\r\n        if (formData.phone && !/^[0-9+\\-\\s()]+$/.test(formData.phone)) {\r\n            setError(\"Số điện thoại không hợp lệ\");\r\n            return false;\r\n        }\r\n\r\n        if (\r\n            formData.referrerPhone &&\r\n            !/^[0-9+\\-\\s()]+$/.test(formData.referrerPhone)\r\n        ) {\r\n            setError(\"Số điện thoại người giới thiệu không hợp lệ\");\r\n            return false;\r\n        }\r\n\r\n        return true;\r\n    };\r\n\r\n    // Handle form submission\r\n    const handleSubmit = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n\r\n        if (!validateForm()) {\r\n            return;\r\n        }\r\n\r\n        setLoading(true);\r\n        setError(null);\r\n        setSuccess(null);\r\n\r\n        try {\r\n            const token = localStorage.getItem(\"token\");\r\n            if (!token) {\r\n                router.push(\"/login\");\r\n                return;\r\n            }\r\n\r\n            // Clean form data\r\n            const submitData = {\r\n                ...formData,\r\n                shortName: formData.shortName.trim() || undefined,\r\n                address: formData.address.trim() || undefined,\r\n                phone: formData.phone.trim() || undefined,\r\n                image: formData.image.trim() || undefined,\r\n                source: formData.source.trim() || undefined,\r\n                referrer: formData.referrer.trim() || undefined,\r\n                referrerPhone: formData.referrerPhone.trim() || undefined,\r\n                serviceGroup: formData.serviceGroup.trim() || undefined,\r\n                marketingClassification:\r\n                    formData.marketingClassification.trim() || undefined,\r\n                salesPerson: formData.salesPerson.trim() || undefined,\r\n                needsNote: formData.needsNote.trim() || undefined,\r\n            };\r\n\r\n            const response = await fetch(\"/api/customers\", {\r\n                method: \"POST\",\r\n                headers: {\r\n                    \"Content-Type\": \"application/json\",\r\n                    Authorization: `Bearer ${token}`,\r\n                },\r\n                body: JSON.stringify(submitData),\r\n            });\r\n\r\n            if (!response.ok) {\r\n                const errorData = await response.json();\r\n                throw new Error(\r\n                    errorData.message || \"Không thể tạo khách hàng mới\",\r\n                );\r\n            }\r\n\r\n            const data = await response.json();\r\n            if (data.success) {\r\n                setSuccess(\"Tạo khách hàng mới thành công!\");\r\n                setTimeout(() => {\r\n                    router.push(\"/khach-hang\");\r\n                }, 2000);\r\n            }\r\n        } catch (err) {\r\n            console.error(\"Error creating customer:\", err);\r\n            setError(err instanceof Error ? err.message : \"Có lỗi xảy ra\");\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    // Get potential level icon\r\n    const getPotentialIcon = (level: string) => {\r\n        switch (level) {\r\n            case \"Cao\":\r\n                return <TrendingUp className=\"w-4 h-4\" />;\r\n            case \"Trung bình\":\r\n                return <Star className=\"w-4 h-4\" />;\r\n            case \"Thấp\":\r\n                return <Clock className=\"w-4 h-4\" />;\r\n            default:\r\n                return <Star className=\"w-4 h-4\" />;\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"min-h-screen bg-gray-50 p-6\">\r\n            {/* Add Mapbox GL CSS */}\r\n            <link\r\n                href=\"https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css\"\r\n                rel=\"stylesheet\"\r\n            />\r\n\r\n            {/* Header */}\r\n            <div className=\"bg-white rounded-lg shadow-sm p-6 mb-6\">\r\n                <div className=\"flex items-center justify-between\">\r\n                    <div className=\"flex items-center\">\r\n                        <button\r\n                            onClick={() => router.back()}\r\n                            className=\"mr-4 p-2 text-gray-600 hover:text-gray-900 hover:bg-gray-100 rounded-lg transition\"\r\n                        >\r\n                            <ArrowLeft className=\"w-5 h-5\" />\r\n                        </button>\r\n                        <div className=\"flex items-center\">\r\n                            <User className=\"w-8 h-8 text-blue-600 mr-3\" />\r\n                            <div>\r\n                                <h1 className=\"text-2xl font-bold text-gray-900\">\r\n                                    Tạo khách hàng mới\r\n                                </h1>\r\n                                <p className=\"text-gray-600\">\r\n                                    Thêm thông tin khách hàng tiềm năng vào hệ\r\n                                    thống\r\n                                </p>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Success/Error Messages */}\r\n            {success && (\r\n                <div className=\"mb-6 bg-green-50 border border-green-200 rounded-lg p-4\">\r\n                    <div className=\"flex items-center\">\r\n                        <CheckCircle className=\"w-5 h-5 text-green-600 mr-2\" />\r\n                        <p className=\"text-green-800\">{success}</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {error && (\r\n                <div className=\"mb-6 bg-red-50 border border-red-200 rounded-lg p-4\">\r\n                    <div className=\"flex items-center\">\r\n                        <AlertCircle className=\"w-5 h-5 text-red-600 mr-2\" />\r\n                        <p className=\"text-red-800\">{error}</p>\r\n                    </div>\r\n                </div>\r\n            )}\r\n\r\n            {/* Form */}\r\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\r\n                {/* Basic Information */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                        <Building className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n                        Thông tin cơ bản\r\n                    </h2>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Tên đầy đủ{\" \"}\r\n                                <span className=\"text-red-600\">*</span>\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"fullName\"\r\n                                value={formData.fullName}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Nhập tên đầy đủ của khách hàng\"\r\n                                required\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Tên viết tắt\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"shortName\"\r\n                                value={formData.shortName}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Tên viết tắt (không bắt buộc)\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Đường dẫn Google Maps\r\n                            </label>\r\n                            <div className=\"flex gap-2\">\r\n                                <input\r\n                                    type=\"url\"\r\n                                    placeholder=\"https://maps.app.goo.gl/w4yMSQyzwbDirjSg9 hoặc iframe embed code\"\r\n                                    className=\"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                    onKeyPress={(e) => {\r\n                                        if (e.key === \"Enter\") {\r\n                                            handleGoogleMapsUrl(\r\n                                                (e.target as HTMLInputElement)\r\n                                                    .value,\r\n                                            );\r\n                                        }\r\n                                    }}\r\n                                />\r\n                                <button\r\n                                    type=\"button\"\r\n                                    onClick={(e) => {\r\n                                        const input =\r\n                                            e.currentTarget.parentElement?.querySelector(\r\n                                                \"input\",\r\n                                            ) as HTMLInputElement;\r\n                                        handleGoogleMapsUrl(input.value);\r\n                                    }}\r\n                                    disabled={isSearching}\r\n                                    className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center disabled:opacity-50\"\r\n                                >\r\n                                    {isSearching ? (\r\n                                        <Loader2 className=\"w-4 h-4 animate-spin\" />\r\n                                    ) : (\r\n                                        <MapPin className=\"w-4 h-4\" />\r\n                                    )}\r\n                                </button>\r\n                            </div>\r\n                            <p className=\"text-xs text-gray-500 mt-1\">\r\n                                Dán đường dẫn Google Maps hoặc iframe embed code\r\n                                để tự động lấy tọa độ và địa chỉ\r\n                            </p>\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2\">\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Địa chỉ\r\n                            </label>\r\n                            <div className=\"relative\">\r\n                                <input\r\n                                    type=\"text\"\r\n                                    name=\"address\"\r\n                                    value={formData.address}\r\n                                    onChange={handleAddressInputChange}\r\n                                    onKeyDown={handleKeyDown}\r\n                                    onFocus={() =>\r\n                                        setShowSuggestions(\r\n                                            searchResults.length > 0,\r\n                                        )\r\n                                    }\r\n                                    onBlur={() =>\r\n                                        setTimeout(\r\n                                            () => setShowSuggestions(false),\r\n                                            200,\r\n                                        )\r\n                                    }\r\n                                    className=\"w-full px-3 py-2 pr-10 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                    placeholder=\"Nhập địa chỉ và chọn từ gợi ý (tối thiểu 3 ký tự, tìm kiếm sau 2 giây)\"\r\n                                />\r\n                                {isSearching && (\r\n                                    <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\r\n                                        <Loader2 className=\"w-4 h-4 text-blue-600 animate-spin\" />\r\n                                    </div>\r\n                                )}\r\n                                {!isSearching && formData.address && (\r\n                                    <div className=\"absolute right-3 top-1/2 transform -translate-y-1/2\">\r\n                                        <MapPin className=\"w-4 h-4 text-green-600\" />\r\n                                    </div>\r\n                                )}\r\n                            </div>\r\n\r\n                            {/* Search Status */}\r\n                            {searchTimeoutRef.current &&\r\n                                !isSearching &&\r\n                                formData.address.length >= 3 && (\r\n                                    <div className=\"mt-1 text-xs text-gray-500 flex items-center\">\r\n                                        <Clock className=\"w-3 h-3 mr-1\" />\r\n                                        Đang tìm kiếm địa chỉ...\r\n                                    </div>\r\n                                )}\r\n\r\n                            {/* Autocomplete Dropdown */}\r\n                            {showSuggestions && searchResults.length > 0 && (\r\n                                <div className=\"mt-1 border border-gray-300 rounded-lg shadow-lg bg-white max-h-60 overflow-y-auto z-50\">\r\n                                    {searchResults.map((result, index) => (\r\n                                        <div\r\n                                            key={index}\r\n                                            onClick={() =>\r\n                                                selectAddress(result)\r\n                                            }\r\n                                            className={`px-3 py-3 cursor-pointer border-b border-gray-100 last:border-b-0 transition-colors ${\r\n                                                selectedIndex === index\r\n                                                    ? \"bg-blue-50 text-blue-700 border-l-2 border-blue-500\"\r\n                                                    : \"hover:bg-gray-50\"\r\n                                            }`}\r\n                                        >\r\n                                            <div className=\"flex items-start\">\r\n                                                <MapPin className=\"w-4 h-4 text-gray-400 mt-0.5 mr-2 flex-shrink-0\" />\r\n                                                <div className=\"flex-1\">\r\n                                                    <p className=\"text-sm text-gray-900 leading-relaxed\">\r\n                                                        {result.display_name}\r\n                                                    </p>\r\n                                                </div>\r\n                                                {selectedIndex === index && (\r\n                                                    <CheckCircle className=\"w-4 h-4 text-blue-600 ml-2 flex-shrink-0\" />\r\n                                                )}\r\n                                            </div>\r\n                                        </div>\r\n                                    ))}\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Vĩ độ\r\n                            </label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"any\"\r\n                                name=\"lat\"\r\n                                value={formData.lat}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Vĩ độ\"\r\n                                readOnly\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Kinh độ\r\n                            </label>\r\n                            <input\r\n                                type=\"number\"\r\n                                step=\"any\"\r\n                                name=\"lng\"\r\n                                value={formData.lng}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Kinh độ\"\r\n                                readOnly\r\n                            />\r\n                        </div>\r\n\r\n                        <div className=\"md:col-span-2\">\r\n                            <button\r\n                                type=\"button\"\r\n                                onClick={() => setShowMap(!showMap)}\r\n                                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors flex items-center\"\r\n                            >\r\n                                <MapPin className=\"w-4 h-4 mr-2\" />\r\n                                {showMap ? \"Ẩn bản đồ\" : \"Hiển thị bản đồ\"}\r\n                            </button>\r\n                        </div>\r\n\r\n                        {showMap && (\r\n                            <div className=\"md:col-span-2\">\r\n                                <div\r\n                                    id=\"mapbox-map\"\r\n                                    className=\"border border-gray-300 rounded-lg overflow-hidden\"\r\n                                    style={{ height: \"400px\" }}\r\n                                />\r\n                                <p className=\"text-sm text-gray-500 mt-2\">\r\n                                    Click vào bản đồ để chọn vị trí hoặc sử dụng\r\n                                    ô tìm kiếm địa chỉ ở trên\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Trạng thái\r\n                            </label>\r\n                            <div className=\"flex items-center\">\r\n                                <input\r\n                                    type=\"checkbox\"\r\n                                    name=\"isActive\"\r\n                                    id=\"isActive\"\r\n                                    checked={formData.isActive}\r\n                                    onChange={handleInputChange}\r\n                                    className=\"h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 rounded\"\r\n                                />\r\n                                <label\r\n                                    htmlFor=\"isActive\"\r\n                                    className=\"ml-2 text-sm text-gray-700\"\r\n                                >\r\n                                    Khách hàng hoạt động\r\n                                </label>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Contact Information */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                        <Phone className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n                        Thông tin liên hệ\r\n                    </h2>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Số điện thoại\r\n                            </label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                name=\"phone\"\r\n                                value={formData.phone}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Số điện thoại liên hệ\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Hình ảnh\r\n                            </label>\r\n                            <div className=\"space-y-3\">\r\n                                {/* Image Upload Area */}\r\n                                <div className=\"relative\">\r\n                                    <input\r\n                                        type=\"file\"\r\n                                        id=\"image-upload\"\r\n                                        accept=\"image/*\"\r\n                                        onChange={handleImageUpload}\r\n                                        className=\"hidden\"\r\n                                        disabled={uploadingImage}\r\n                                    />\r\n                                    <label\r\n                                        htmlFor=\"image-upload\"\r\n                                        className={`\r\n                                            flex items-center justify-center w-full h-32 border-2 border-dashed rounded-lg cursor-pointer transition\r\n                                            ${\r\n                                                uploadingImage\r\n                                                    ? \"border-gray-300 bg-gray-50 cursor-not-allowed\"\r\n                                                    : \"border-gray-300 hover:border-blue-400 hover:bg-blue-50\"\r\n                                            }\r\n                                        `}\r\n                                    >\r\n                                        {uploadingImage ? (\r\n                                            <div className=\"flex flex-col items-center\">\r\n                                                <Loader2 className=\"w-8 h-8 text-blue-600 animate-spin mb-2\" />\r\n                                                <span className=\"text-sm text-gray-600\">\r\n                                                    Đang tải ảnh...\r\n                                                </span>\r\n                                            </div>\r\n                                        ) : formData.image ? (\r\n                                            <div className=\"flex flex-col items-center\">\r\n                                                <ImageIcon className=\"w-8 h-8 text-green-600 mb-2\" />\r\n                                                <span className=\"text-sm text-green-600\">\r\n                                                    Đã tải ảnh\r\n                                                </span>\r\n                                                <span className=\"text-xs text-gray-500 mt-1\">\r\n                                                    Click để thay đổi\r\n                                                </span>\r\n                                            </div>\r\n                                        ) : (\r\n                                            <div className=\"flex flex-col items-center\">\r\n                                                <Upload className=\"w-8 h-8 text-gray-400 mb-2\" />\r\n                                                <span className=\"text-sm text-gray-600\">\r\n                                                    Tải ảnh lên\r\n                                                </span>\r\n                                                <span className=\"text-xs text-gray-500 mt-1\">\r\n                                                    JPG, PNG, GIF (max 5MB)\r\n                                                </span>\r\n                                            </div>\r\n                                        )}\r\n                                    </label>\r\n                                </div>\r\n\r\n                                {/* Image Preview */}\r\n                                {formData.image && (\r\n                                    <div className=\"relative\">\r\n                                        <img\r\n                                            src={formData.image}\r\n                                            alt=\"Customer preview\"\r\n                                            className=\"w-full h-48 object-cover rounded-lg border border-gray-200\"\r\n                                        />\r\n                                        <button\r\n                                            type=\"button\"\r\n                                            onClick={() =>\r\n                                                setFormData((prev) => ({\r\n                                                    ...prev,\r\n                                                    image: \"\",\r\n                                                }))\r\n                                            }\r\n                                            className=\"absolute top-2 right-2 bg-red-500 text-white p-1 rounded-full hover:bg-red-600 transition\"\r\n                                        >\r\n                                            <X className=\"w-4 h-4\" />\r\n                                        </button>\r\n                                    </div>\r\n                                )}\r\n\r\n                                {/* Hidden input for form submission */}\r\n                                <input\r\n                                    type=\"hidden\"\r\n                                    name=\"image\"\r\n                                    value={formData.image}\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Source and Classification */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                        <Star className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n                        Nguồn và Phân loại\r\n                    </h2>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Nguồn khách hàng\r\n                            </label>\r\n                            <select\r\n                                name=\"source\"\r\n                                value={formData.source}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                            >\r\n                                <option value=\"\">-- Chọn nguồn --</option>\r\n                                <option value=\"Google Ads\">Google Ads</option>\r\n                                <option value=\"Facebook\">Facebook</option>\r\n                                <option value=\"Sales tự tìm\">\r\n                                    Sales tự tìm\r\n                                </option>\r\n                                <option value=\"BGĐ giao\">BGĐ giao</option>\r\n                                <option value=\"CTV/ Referrals\">\r\n                                    CTV/ Referrals\r\n                                </option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Mức độ tiềm năng\r\n                            </label>\r\n                            <select\r\n                                name=\"potentialLevel\"\r\n                                value={formData.potentialLevel}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                            >\r\n                                <option value=\"Cao\">Cao</option>\r\n                                <option value=\"Trung bình\">Trung bình</option>\r\n                                <option value=\"Thấp\">Thấp</option>\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Nhóm dịch vụ\r\n                            </label>\r\n                            <select\r\n                                name=\"serviceGroup\"\r\n                                value={formData.serviceGroup}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                            >\r\n                                <option value=\"\">Chọn nhóm dịch vụ</option>\r\n                                {serviceGroups.map((group) => (\r\n                                    <option key={group._id} value={group.name}>\r\n                                        {group.name}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        {/* <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Phân loại marketing\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"marketingClassification\"\r\n                                value={formData.marketingClassification}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Phân loại marketing\"\r\n                            />\r\n                        </div> */}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Referrer Information */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                        <User className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n                        Thông tin người giới thiệu\r\n                    </h2>\r\n\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Tên người giới thiệu\r\n                            </label>\r\n                            <input\r\n                                type=\"text\"\r\n                                name=\"referrer\"\r\n                                value={formData.referrer}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Tên người giới thiệu\"\r\n                            />\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Số điện thoại người giới thiệu\r\n                            </label>\r\n                            <input\r\n                                type=\"tel\"\r\n                                name=\"referrerPhone\"\r\n                                value={formData.referrerPhone}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Số điện thoại người giới thiệu\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Assignment and Notes */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <h2 className=\"text-lg font-semibold text-gray-900 mb-4 flex items-center\">\r\n                        <Calendar className=\"w-5 h-5 mr-2 text-blue-600\" />\r\n                        Phân công và Ghi chú\r\n                    </h2>\r\n\r\n                    <div className=\"grid grid-cols-1 gap-6\">\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Nhân viên phụ trách\r\n                            </label>\r\n                            <select\r\n                                name=\"salesPerson\"\r\n                                value={formData.salesPerson}\r\n                                onChange={handleInputChange}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                            >\r\n                                <option value=\"\">-- Chọn nhân viên --</option>\r\n                                {salesPersons.map((person) => (\r\n                                    <option\r\n                                        key={person._id}\r\n                                        value={person.fullName}\r\n                                    >\r\n                                        {person.fullName} -{\" \"}\r\n                                        {person.position || \"Nhân viên\"}\r\n                                    </option>\r\n                                ))}\r\n                            </select>\r\n                        </div>\r\n\r\n                        <div>\r\n                            <label className=\"block text-sm font-medium text-gray-700 mb-2\">\r\n                                Nhu cầu và ghi chú\r\n                            </label>\r\n                            <textarea\r\n                                name=\"needsNote\"\r\n                                value={formData.needsNote}\r\n                                onChange={handleInputChange}\r\n                                rows={4}\r\n                                className=\"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none\"\r\n                                placeholder=\"Ghi chú về nhu cầu, yêu cầu của khách hàng...\"\r\n                            />\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n\r\n                {/* Action Buttons */}\r\n                <div className=\"bg-white rounded-lg shadow-sm p-6\">\r\n                    <div className=\"flex items-center justify-end space-x-4\">\r\n                        <button\r\n                            type=\"button\"\r\n                            onClick={() => router.back()}\r\n                            className=\"flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition\"\r\n                        >\r\n                            <X className=\"w-5 h-5 mr-2\" />\r\n                            Hủy\r\n                        </button>\r\n                        <button\r\n                            type=\"submit\"\r\n                            disabled={loading}\r\n                            className=\"flex items-center px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed\"\r\n                        >\r\n                            <Save className=\"w-5 h-5 mr-2\" />\r\n                            {loading ? \"Đang lưu...\" : \"Lưu khách hàng\"}\r\n                        </button>\r\n                    </div>\r\n                </div>\r\n            </form>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default CreateCustomer;\r\n"],"names":[],"mappings":"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"}}]
}