{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI!;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\",\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    // console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    console.log(\"üì° Connecting to MongoDB...\");\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      console.log(\"‚úÖ MongoDB connected successfully\");\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    console.error(\"‚ùå MongoDB connection error:\", e);\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,uDAAuD;QACvD,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/CategoryItem.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface ICategoryItem extends Document {\r\n  groupId: mongoose.Types.ObjectId;\r\n  name: string;\r\n  code: string;\r\n  note?: string;\r\n  isActive: boolean;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nconst CategoryItemSchema: Schema = new Schema(\r\n  {\r\n    groupId: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"CategoryGroup\",\r\n      required: true,\r\n    },\r\n    name: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n    code: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      uppercase: true,\r\n      trim: true,\r\n    },\r\n    note: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    isActive: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n    collection: \"H·∫°ng m·ª•c\",\r\n  },\r\n);\r\n\r\nexport default mongoose.models.CategoryItem ||\r\n  mongoose.model<ICategoryItem>(\"CategoryItem\", CategoryItemSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAYA,MAAM,qBAA6B,IAAI,kKAAM,CAC3C;IACE,SAAS;QACP,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;QACL,UAAU;IACZ;IACA,MAAM;QACJ,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;uCAGa,mKAAQ,CAAC,MAAM,CAAC,YAAY,IACzC,mKAAQ,CAAC,KAAK,CAAgB,gBAAgB"}},
    {"offset": {"line": 137, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/app/api/category-items/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport dbConnect from \"../../../lib/dbConnect\";\r\nimport CategoryItem from \"../../../models/CategoryItem\";\r\nimport CategoryGroup from \"../../../models/CategoryGroup\";\r\n\r\nexport async function GET(request: NextRequest) {\r\n  try {\r\n    await dbConnect();\r\n\r\n    const { searchParams } = new URL(request.url);\r\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\r\n    const limit = parseInt(searchParams.get(\"limit\") || \"10\");\r\n    const search = searchParams.get(\"search\") || \"\";\r\n    const isActive = searchParams.get(\"isActive\");\r\n    const groupId = searchParams.get(\"groupId\");\r\n\r\n    const query: any = {};\r\n\r\n    if (groupId) {\r\n      query.groupId = groupId;\r\n    }\r\n\r\n    if (search) {\r\n      query.$or = [\r\n        { name: { $regex: search, $options: \"i\" } },\r\n        { code: { $regex: search, $options: \"i\" } },\r\n        { note: { $regex: search, $options: \"i\" } },\r\n      ];\r\n    }\r\n\r\n    if (isActive !== null && isActive !== undefined) {\r\n      query.isActive = isActive === \"true\";\r\n    }\r\n\r\n    const skip = (page - 1) * limit;\r\n\r\n    const [data, total] = await Promise.all([\r\n      CategoryItem.find(query)\r\n        .populate(\"groupId\", \"name code\")\r\n        .sort({ createdAt: -1 })\r\n        .skip(skip)\r\n        .limit(limit),\r\n      CategoryItem.countDocuments(query),\r\n    ]);\r\n\r\n    return NextResponse.json({\r\n      success: true,\r\n      data,\r\n      pagination: {\r\n        page,\r\n        limit,\r\n        total,\r\n        pages: Math.ceil(total / limit),\r\n      },\r\n    });\r\n  } catch (error) {\r\n    console.error(\"Error fetching category items:\", error);\r\n    return NextResponse.json(\r\n      { success: false, error: \"Kh√¥ng th·ªÉ l·∫•y danh s√°ch h·∫°ng m·ª•c\" },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    await dbConnect();\r\n    const body = await request.json();\r\n    const { groupId, name, note } = body;\r\n\r\n    if (!groupId || !name) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"Nh√≥m v√† t√™n h·∫°ng m·ª•c l√† b·∫Øt bu·ªôc\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    // T·ª± ƒë·ªông t·∫°o m√£ h·∫°ng m·ª•c: HM-0001\r\n    const count = await CategoryItem.countDocuments();\r\n    const generatedCode = `HM-${String(count + 1).padStart(4, \"0\")}`;\r\n\r\n    const categoryItem = new CategoryItem({\r\n      groupId,\r\n      name: name.trim(),\r\n      code: generatedCode,\r\n      note: note?.trim() || \"\",\r\n    });\r\n\r\n    await categoryItem.save();\r\n\r\n    return NextResponse.json(\r\n      {\r\n        success: true,\r\n        data: categoryItem,\r\n        message: \"T·∫°o h·∫°ng m·ª•c th√†nh c√¥ng\",\r\n      },\r\n      { status: 201 },\r\n    );\r\n  } catch (error: any) {\r\n    console.error(\"Error creating category item:\", error);\r\n\r\n    if (error.code === 11000) {\r\n      return NextResponse.json(\r\n        { success: false, error: \"M√£ h·∫°ng m·ª•c ƒë√£ t·ªìn t·∫°i\" },\r\n        { status: 400 },\r\n      );\r\n    }\r\n\r\n    return NextResponse.json(\r\n      { success: false, error: \"Kh√¥ng th·ªÉ t·∫°o h·∫°ng m·ª•c\" },\r\n      { status: 500 },\r\n    );\r\n  }\r\n}\r\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAGO,eAAe,IAAI,OAAoB;IAC5C,IAAI;QACF,MAAM,IAAA,6HAAS;QAEf,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,OAAO,SAAS,aAAa,GAAG,CAAC,WAAW;QAClD,MAAM,QAAQ,SAAS,aAAa,GAAG,CAAC,YAAY;QACpD,MAAM,SAAS,aAAa,GAAG,CAAC,aAAa;QAC7C,MAAM,WAAW,aAAa,GAAG,CAAC;QAClC,MAAM,UAAU,aAAa,GAAG,CAAC;QAEjC,MAAM,QAAa,CAAC;QAEpB,IAAI,SAAS;YACX,MAAM,OAAO,GAAG;QAClB;QAEA,IAAI,QAAQ;YACV,MAAM,GAAG,GAAG;gBACV;oBAAE,MAAM;wBAAE,QAAQ;wBAAQ,UAAU;oBAAI;gBAAE;gBAC1C;oBAAE,MAAM;wBAAE,QAAQ;wBAAQ,UAAU;oBAAI;gBAAE;gBAC1C;oBAAE,MAAM;wBAAE,QAAQ;wBAAQ,UAAU;oBAAI;gBAAE;aAC3C;QACH;QAEA,IAAI,aAAa,QAAQ,aAAa,WAAW;YAC/C,MAAM,QAAQ,GAAG,aAAa;QAChC;QAEA,MAAM,OAAO,CAAC,OAAO,CAAC,IAAI;QAE1B,MAAM,CAAC,MAAM,MAAM,GAAG,MAAM,QAAQ,GAAG,CAAC;YACtC,mIAAY,CAAC,IAAI,CAAC,OACf,QAAQ,CAAC,WAAW,aACpB,IAAI,CAAC;gBAAE,WAAW,CAAC;YAAE,GACrB,IAAI,CAAC,MACL,KAAK,CAAC;YACT,mIAAY,CAAC,cAAc,CAAC;SAC7B;QAED,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,SAAS;YACT;YACA,YAAY;gBACV;gBACA;gBACA;gBACA,OAAO,KAAK,IAAI,CAAC,QAAQ;YAC3B;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,kCAAkC;QAChD,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAmC,GAC5D;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,MAAM,IAAA,6HAAS;QACf,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,GAAG;QAEhC,IAAI,CAAC,WAAW,CAAC,MAAM;YACrB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAmC,GAC5D;gBAAE,QAAQ;YAAI;QAElB;QAEA,mCAAmC;QACnC,MAAM,QAAQ,MAAM,mIAAY,CAAC,cAAc;QAC/C,MAAM,gBAAgB,CAAC,GAAG,EAAE,OAAO,QAAQ,GAAG,QAAQ,CAAC,GAAG,MAAM;QAEhE,MAAM,eAAe,IAAI,mIAAY,CAAC;YACpC;YACA,MAAM,KAAK,IAAI;YACf,MAAM;YACN,MAAM,MAAM,UAAU;QACxB;QAEA,MAAM,aAAa,IAAI;QAEvB,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,SAAS;YACT,MAAM;YACN,SAAS;QACX,GACA;YAAE,QAAQ;QAAI;IAElB,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,iCAAiC;QAE/C,IAAI,MAAM,IAAI,KAAK,OAAO;YACxB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,SAAS;gBAAO,OAAO;YAAyB,GAClD;gBAAE,QAAQ;YAAI;QAElB;QAEA,OAAO,gJAAY,CAAC,IAAI,CACtB;YAAE,SAAS;YAAO,OAAO;QAAyB,GAClD;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}