{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/ServiceGroup.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\n\nexport interface IServiceGroup extends Document {\n    name: string;\n    code: string;\n    description?: string;\n    isActive: boolean;\n    createdAt?: Date;\n    updatedAt?: Date;\n}\n\nconst ServiceGroupSchema: Schema = new Schema(\n    {\n        name: {\n            type: String,\n            required: true,\n            trim: true,\n        },\n        code: {\n            type: String,\n            required: true,\n            unique: true,\n            uppercase: true,\n            trim: true,\n        },\n        description: {\n            type: String,\n            trim: true,\n        },\n        isActive: {\n            type: Boolean,\n            default: true,\n        },\n    },\n    {\n        timestamps: true,\n        collection: \"Nh√≥m d·ªãch v·ª•\",\n    },\n);\n\nexport default mongoose.models.ServiceGroup ||\n    mongoose.model<IServiceGroup>(\"ServiceGroup\", ServiceGroupSchema);\n"],"names":[],"mappings":";;;;AAAA;;AAWA,MAAM,qBAA6B,IAAI,kKAAM,CACzC;IACI,MAAM;QACF,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,MAAM;QACF,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACV;IACA,aAAa;QACT,MAAM;QACN,MAAM;IACV;IACA,UAAU;QACN,MAAM;QACN,SAAS;IACb;AACJ,GACA;IACI,YAAY;IACZ,YAAY;AAChB;uCAGW,mKAAQ,CAAC,MAAM,CAAC,YAAY,IACvC,mKAAQ,CAAC,KAAK,CAAgB,gBAAgB"}},
    {"offset": {"line": 82, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI!;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\",\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    // console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    console.log(\"üì° Connecting to MongoDB...\");\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      console.log(\"‚úÖ MongoDB connected successfully\");\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    console.error(\"‚ùå MongoDB connection error:\", e);\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,uDAAuD;QACvD,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 132, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/app/api/service-groups/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport ServiceGroup from \"@/models/ServiceGroup\";\nimport dbConnect from \"@/lib/dbConnect\";\n\n// GET - L·∫•y danh s√°ch nh√≥m d·ªãch v·ª•\nexport async function GET(request: NextRequest) {\n  try {\n    await dbConnect();\n\n    const { searchParams } = new URL(request.url);\n    const page = parseInt(searchParams.get(\"page\") || \"1\");\n    const limit = parseInt(searchParams.get(\"limit\") || \"10\");\n    const search = searchParams.get(\"search\") || \"\";\n    const status = searchParams.get(\"status\") || \"all\";\n\n    const query: any = {};\n\n    // T√¨m ki·∫øm theo t√™n ho·∫∑c m√£\n    if (search) {\n      query.$or = [\n        { name: { $regex: search, $options: \"i\" } },\n        { code: { $regex: search, $options: \"i\" } },\n      ];\n    }\n\n    // L·ªçc theo tr·∫°ng th√°i\n    if (status !== \"all\") {\n      query.isActive = status === \"active\";\n    }\n\n    const skip = (page - 1) * limit;\n\n    const [serviceGroups, total] = await Promise.all([\n      ServiceGroup.find(query).sort({ createdAt: -1 }).skip(skip).limit(limit),\n      ServiceGroup.countDocuments(query),\n    ]);\n\n    return NextResponse.json({\n      success: true,\n      data: serviceGroups,\n      pagination: {\n        page,\n        limit,\n        total,\n        totalPages: Math.ceil(total / limit),\n      },\n    });\n  } catch (error: any) {\n    console.error(\"Error fetching service groups:\", error);\n    return NextResponse.json(\n      { success: false, message: \"Kh√¥ng th·ªÉ t·∫£i danh s√°ch nh√≥m d·ªãch v·ª•\" },\n      { status: 500 },\n    );\n  }\n}\n\n// POST - T·∫°o nh√≥m d·ªãch v·ª• m·ªõi\nexport async function POST(request: NextRequest) {\n  try {\n    await dbConnect();\n\n    const body = await request.json();\n    const { name, description, isActive } = body;\n\n    // Validation\n    if (!name || !name.trim()) {\n      return NextResponse.json(\n        { success: false, message: \"T√™n nh√≥m d·ªãch v·ª• l√† b·∫Øt bu·ªôc\" },\n        { status: 400 },\n      );\n    }\n\n    // T·ª± ƒë·ªông t·∫°o m√£ nh√≥m d·ªãch v·ª• (SG-XXXX)\n    const lastGroup = await ServiceGroup.findOne({}, { code: 1 }).sort({\n      code: -1,\n    });\n    let newCode = \"SG-0001\";\n\n    if (lastGroup && lastGroup.code && lastGroup.code.startsWith(\"SG-\")) {\n      const currentNumber = parseInt(lastGroup.code.replace(\"SG-\", \"\"));\n      if (!isNaN(currentNumber)) {\n        newCode = `SG-${(currentNumber + 1).toString().padStart(4, \"0\")}`;\n      }\n    } else if (lastGroup && lastGroup.code) {\n      // Tr∆∞·ªùng h·ª£p c√≥ d·ªØ li·ªáu c≈© kh√¥ng ƒë√∫ng format SG-\n      const count = await ServiceGroup.countDocuments();\n      newCode = `SG-${(count + 1).toString().padStart(4, \"0\")}`;\n    }\n\n    // T·∫°o nh√≥m d·ªãch v·ª• m·ªõi\n    const serviceGroup = new ServiceGroup({\n      name: name.trim(),\n      code: newCode,\n      description: description?.trim() || \"\",\n      isActive: isActive !== undefined ? isActive : true,\n    });\n\n    await serviceGroup.save();\n\n    return NextResponse.json({\n      success: true,\n      message: \"T·∫°o nh√≥m d·ªãch v·ª• th√†nh c√¥ng\",\n      data: serviceGroup,\n    });\n  } catch (error: any) {\n    console.error(\"Error creating service group:\", error);\n\n    return NextResponse.json(\n      { success: false, message: \"Kh√¥ng th·ªÉ t·∫°o nh√≥m d·ªãch v·ª• m·ªõi\" },\n      { status: 500 },\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}