{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/lib/dbConnect.ts"],"sourcesContent":["import mongoose from \"mongoose\";\r\n\r\nconst MONGODB_URI = process.env.MONGODB_URI!;\r\n\r\nif (!MONGODB_URI) {\r\n  throw new Error(\r\n    \"Please define the MONGODB_URI environment variable inside .env.local\",\r\n  );\r\n}\r\n\r\n/**\r\n * Global is used here to maintain a cached connection across hot reloads\r\n * in development. This prevents connections growing exponentially\r\n * during API Route usage.\r\n */\r\nlet cached = (global as any).mongoose;\r\n\r\nif (!cached) {\r\n  cached = (global as any).mongoose = { conn: null, promise: null };\r\n}\r\n\r\nasync function dbConnect() {\r\n  if (cached.conn) {\r\n    // console.log(\"‚ôªÔ∏è Using existing MongoDB connection\");\r\n    return cached.conn;\r\n  }\r\n\r\n  if (!cached.promise) {\r\n    const opts = {\r\n      bufferCommands: false,\r\n    };\r\n\r\n    console.log(\"üì° Connecting to MongoDB...\");\r\n    cached.promise = mongoose.connect(MONGODB_URI, opts).then((mongoose) => {\r\n      console.log(\"‚úÖ MongoDB connected successfully\");\r\n      return mongoose;\r\n    });\r\n  }\r\n\r\n  try {\r\n    cached.conn = await cached.promise;\r\n  } catch (e) {\r\n    cached.promise = null;\r\n    console.error(\"‚ùå MongoDB connection error:\", e);\r\n    throw e;\r\n  }\r\n\r\n  return cached.conn;\r\n}\r\n\r\nexport default dbConnect;\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,cAAc,QAAQ,GAAG,CAAC,WAAW;AAE3C,IAAI,CAAC,aAAa;IAChB,MAAM,IAAI,MACR;AAEJ;AAEA;;;;CAIC,GACD,IAAI,SAAS,yDAAgB,QAAQ;AAErC,IAAI,CAAC,QAAQ;IACX,SAAS,yDAAgB,QAAQ,GAAG;QAAE,MAAM;QAAM,SAAS;IAAK;AAClE;AAEA,eAAe;IACb,IAAI,OAAO,IAAI,EAAE;QACf,uDAAuD;QACvD,OAAO,OAAO,IAAI;IACpB;IAEA,IAAI,CAAC,OAAO,OAAO,EAAE;QACnB,MAAM,OAAO;YACX,gBAAgB;QAClB;QAEA,QAAQ,GAAG,CAAC;QACZ,OAAO,OAAO,GAAG,mKAAQ,CAAC,OAAO,CAAC,aAAa,MAAM,IAAI,CAAC,CAAC;YACzD,QAAQ,GAAG,CAAC;YACZ,OAAO;QACT;IACF;IAEA,IAAI;QACF,OAAO,IAAI,GAAG,MAAM,OAAO,OAAO;IACpC,EAAE,OAAO,GAAG;QACV,OAAO,OAAO,GAAG;QACjB,QAAQ,KAAK,CAAC,+BAA+B;QAC7C,MAAM;IACR;IAEA,OAAO,OAAO,IAAI;AACpB;uCAEe"}},
    {"offset": {"line": 96, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/Customer.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface ICustomer extends Document {\r\n  customerId: string;\r\n  registrationDate?: Date;\r\n  fullName: string;\r\n  shortName?: string;\r\n  address?: string;\r\n  phone?: string;\r\n  image?: string;\r\n  source?: string;\r\n  referrer?: string;\r\n  referrerPhone?: string;\r\n  opportunityHistory: mongoose.Types.ObjectId[];\r\n  appraisalDate?: Date; // Ng√†y th·∫©m ƒë·ªãnh\r\n  appraisalStatus?: string; // X·∫øp lo·∫°i (Ph√π h·ª£p/Kh√¥ng ph√π h·ª£p...)\r\n  appraisalNote?: string; // Ghi ch√∫ th·∫©m ƒë·ªãnh chi ti·∫øt\r\n  potentialLevel?: string; // 1 - 5 stars\r\n  assignedTo?: mongoose.Types.ObjectId;\r\n  needsNote?: string;\r\n  trueCustomerDate?: Date; // khi c√≥ h·ª£p ƒë·ªìng ƒë·∫ßu ti√™n th√†nh c√¥ng\r\n  firstContractValue?: number; // gi√° tr·ªã h·ª£p ƒë·ªìng ƒë·∫ßu ti√™n th√†nh c√¥ng\r\n  isActive: boolean;\r\n  latitude?: number;\r\n  longitude?: number;\r\n  isDel: boolean;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nconst CustomerSchema: Schema = new Schema(\r\n  {\r\n    customerId: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      trim: true,\r\n    },\r\n    registrationDate: {\r\n      type: Date,\r\n    },\r\n    fullName: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n    shortName: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    address: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    phone: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    image: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    source: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    referrer: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    referrerPhone: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    opportunityHistory: [\r\n      {\r\n        type: Schema.Types.ObjectId,\r\n        ref: \"Opportunity\",\r\n      },\r\n    ],\r\n    appraisalDate: {\r\n      type: Date,\r\n    },\r\n    appraisalStatus: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    appraisalNote: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    potentialLevel: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    assignedTo: {\r\n      type: Schema.Types.ObjectId,\r\n      ref: \"Employee\",\r\n    },\r\n    needsNote: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    isActive: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    trueCustomerDate: {\r\n      type: Date,\r\n    },\r\n    firstContractValue: {\r\n      type: Number,\r\n      default: 0,\r\n    },\r\n    latitude: {\r\n      type: Number,\r\n    },\r\n    longitude: {\r\n      type: Number,\r\n    },\r\n    isDel: {\r\n      type: Boolean,\r\n      default: false,\r\n    },\r\n  },\r\n  {\r\n    timestamps: true,\r\n    collection: \"Kh√°ch h√†ng\",\r\n  },\r\n);\r\n\r\nconst Customer =\r\n  mongoose.models.Customer ||\r\n  mongoose.model<ICustomer>(\"Customer\", CustomerSchema);\r\nexport default Customer;\r\n"],"names":[],"mappings":";;;;AAAA;;AA8BA,MAAM,iBAAyB,IAAI,kKAAM,CACvC;IACE,YAAY;QACV,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;IACR;IACA,kBAAkB;QAChB,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,WAAW;QACT,MAAM;QACN,MAAM;IACR;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,QAAQ;QACN,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,MAAM;IACR;IACA,eAAe;QACb,MAAM;QACN,MAAM;IACR;IACA,oBAAoB;QAClB;YACE,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;YAC3B,KAAK;QACP;KACD;IACD,eAAe;QACb,MAAM;IACR;IACA,iBAAiB;QACf,MAAM;QACN,MAAM;IACR;IACA,eAAe;QACb,MAAM;QACN,MAAM;IACR;IACA,gBAAgB;QACd,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM,kKAAM,CAAC,KAAK,CAAC,QAAQ;QAC3B,KAAK;IACP;IACA,WAAW;QACT,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,kBAAkB;QAChB,MAAM;IACR;IACA,oBAAoB;QAClB,MAAM;QACN,SAAS;IACX;IACA,UAAU;QACR,MAAM;IACR;IACA,WAAW;QACT,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,SAAS;IACX;AACF,GACA;IACE,YAAY;IACZ,YAAY;AACd;AAGF,MAAM,WACJ,mKAAQ,CAAC,MAAM,CAAC,QAAQ,IACxB,mKAAQ,CAAC,KAAK,CAAY,YAAY;uCACzB"}},
    {"offset": {"line": 205, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/Employee.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface IEmployee extends Document {\r\n  employeeId: string;\r\n  fullName: string;\r\n  position: string;\r\n  phone?: string;\r\n  email?: string;\r\n  address?: string;\r\n  department?: string;\r\n  isActive: boolean;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n  // Account fields\r\n  username?: string;\r\n  password?: string;\r\n  role?: string;\r\n  gender?: string;\r\n  dob?: Date;\r\n  lastLogin?: Date;\r\n  avatar?: string;\r\n}\r\n\r\nconst EmployeeSchema: Schema = new Schema(\r\n  {\r\n    employeeId: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      trim: true,\r\n    },\r\n    fullName: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n    position: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n    phone: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    email: {\r\n      type: String,\r\n      trim: true,\r\n      lowercase: true,\r\n    },\r\n    address: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    department: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    isActive: {\r\n      type: Boolean,\r\n      default: true,\r\n    },\r\n    // Account fields\r\n    username: {\r\n      type: String,\r\n      unique: true,\r\n      sparse: true, // Allow null/undefined to not be unique\r\n      trim: true,\r\n    },\r\n    password: {\r\n      type: String,\r\n    },\r\n    role: {\r\n      type: String,\r\n      default: \"user\",\r\n    },\r\n    gender: String,\r\n    dob: Date,\r\n    lastLogin: Date,\r\n    avatar: String,\r\n  },\r\n  {\r\n    timestamps: true,\r\n    collection: \"Nh√¢n vi√™n\",\r\n  },\r\n);\r\n\r\nexport default mongoose.models.Employee ||\r\n  mongoose.model<IEmployee>(\"Employee\", EmployeeSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAuBA,MAAM,iBAAyB,IAAI,kKAAM,CACvC;IACE,YAAY;QACV,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,MAAM;IACR;IACA,OAAO;QACL,MAAM;QACN,MAAM;QACN,WAAW;IACb;IACA,SAAS;QACP,MAAM;QACN,MAAM;IACR;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,UAAU;QACR,MAAM;QACN,SAAS;IACX;IACA,iBAAiB;IACjB,UAAU;QACR,MAAM;QACN,QAAQ;QACR,QAAQ;QACR,MAAM;IACR;IACA,UAAU;QACR,MAAM;IACR;IACA,MAAM;QACJ,MAAM;QACN,SAAS;IACX;IACA,QAAQ;IACR,KAAK;IACL,WAAW;IACX,QAAQ;AACV,GACA;IACE,YAAY;IACZ,YAAY;AACd;uCAGa,mKAAQ,CAAC,MAAM,CAAC,QAAQ,IACrC,mKAAQ,CAAC,KAAK,CAAY,YAAY"}},
    {"offset": {"line": 276, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/Quotation.ts"],"sourcesContent":["import mongoose, { Document, Schema } from \"mongoose\";\r\nimport Customer from \"./Customer\";\r\n\r\n// Schema cho b√°o gi√° (ch·ª©a th√¥ng tin gi√° v√† t√≠nh to√°n)\r\nconst quotationPackageSchema = new mongoose.Schema({\r\n  serviceGroup: { type: String, required: true }, // nh√≥m d·ªãch v·ª•\r\n  service: { type: String, required: true }, // t√™n d·ªãch v·ª•\r\n  volume: { type: Number, required: true }, // kh·ªëi l∆∞·ª£ng (t·ª´ survey)\r\n  packages: [\r\n    {\r\n      packageName: { type: String, required: true }, // t√™n g√≥i d·ªãch v·ª•\r\n      servicePricing: { type: Number, required: true }, // ƒë∆°n gi√° c·ªßa g√≥i\r\n      totalPrice: { type: Number, required: true }, // th√†nh ti·ªÅn = volume * servicePricing\r\n      isSelected: { type: Boolean, default: false }, // g√≥i ƒë∆∞·ª£c ch·ªçn b·ªüi kh√°ch h√†ng\r\n    },\r\n  ], // m·∫£ng c√°c g√≥i v·ªõi c√πng volume ƒë·ªÉ kh√°ch h√†ng so s√°nh\r\n});\r\n\r\nconst quotationSchema = new mongoose.Schema(\r\n  {\r\n    quotationNo: { type: String, unique: true, required: true },\r\n    date: { type: Date, required: true },\r\n    customer: { type: String, required: true }, // customer name\r\n    customerRef: { type: mongoose.Schema.Types.ObjectId, ref: \"Customer\" }, // reference to customer\r\n    surveyRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"PROJECT_SURVEY\",\r\n    }, // reference to survey\r\n    careRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"CustomerCare\",\r\n    }, // reference to customer care\r\n    opportunityRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"Opportunity\",\r\n    }, // reference to opportunity\r\n    packages: [quotationPackageSchema], // m·∫£ng c√°c g√≥i d·ªãch v·ª• v·ªõi gi√°\r\n    totalAmount: { type: Number, default: 0 }, // t·ªïng th√†nh ti·ªÅn\r\n    grandTotal: { type: Number, default: 0 }, // t·ªïng c·ªông\r\n    status: {\r\n      type: String,\r\n      enum: [\"draft\", \"sent\", \"approved\", \"rejected\", \"completed\"],\r\n      default: \"draft\",\r\n    },\r\n    notes: { type: String }, // ghi ch√∫ b√°o gi√°\r\n    createdBy: { type: String, required: true },\r\n    createdAt: { type: Date, default: Date.now },\r\n    updatedAt: { type: Date, default: Date.now },\r\n  },\r\n  { collection: \"B√°o gi√°\" }, // ƒê·ªïi t√™n ƒë·ªÉ force model m·ªõi\r\n);\r\n\r\nconst Quotation =\r\n  mongoose.models.BaoGia || mongoose.model(\"BaoGia\", quotationSchema);\r\nexport default Quotation;\r\n"],"names":[],"mappings":";;;;AAAA;;AAGA,uDAAuD;AACvD,MAAM,yBAAyB,IAAI,mKAAQ,CAAC,MAAM,CAAC;IACjD,cAAc;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC7C,SAAS;QAAE,MAAM;QAAQ,UAAU;IAAK;IACxC,QAAQ;QAAE,MAAM;QAAQ,UAAU;IAAK;IACvC,UAAU;QACR;YACE,aAAa;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YAC5C,gBAAgB;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YAC/C,YAAY;gBAAE,MAAM;gBAAQ,UAAU;YAAK;YAC3C,YAAY;gBAAE,MAAM;gBAAS,SAAS;YAAM;QAC9C;KACD;AACH;AAEA,MAAM,kBAAkB,IAAI,mKAAQ,CAAC,MAAM,CACzC;IACE,aAAa;QAAE,MAAM;QAAQ,QAAQ;QAAM,UAAU;IAAK;IAC1D,MAAM;QAAE,MAAM;QAAM,UAAU;IAAK;IACnC,UAAU;QAAE,MAAM;QAAQ,UAAU;IAAK;IACzC,aAAa;QAAE,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QAAE,KAAK;IAAW;IACrE,WAAW;QACT,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,SAAS;QACP,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,gBAAgB;QACd,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,UAAU;QAAC;KAAuB;IAClC,aAAa;QAAE,MAAM;QAAQ,SAAS;IAAE;IACxC,YAAY;QAAE,MAAM;QAAQ,SAAS;IAAE;IACvC,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAS;YAAQ;YAAY;YAAY;SAAY;QAC5D,SAAS;IACX;IACA,OAAO;QAAE,MAAM;IAAO;IACtB,WAAW;QAAE,MAAM;QAAQ,UAAU;IAAK;IAC1C,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;IAC3C,WAAW;QAAE,MAAM;QAAM,SAAS,KAAK,GAAG;IAAC;AAC7C,GACA;IAAE,YAAY;AAAU;AAG1B,MAAM,YACJ,mKAAQ,CAAC,MAAM,CAAC,MAAM,IAAI,mKAAQ,CAAC,KAAK,CAAC,UAAU;uCACtC"}},
    {"offset": {"line": 393, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/CustomerCare.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\n/**\r\n * Interface cho th√¥ng tin kh√°ch h√†ng nh√∫ng (Extended Reference)\r\n * Gi√∫p l·∫•y nhanh c√°c th√¥ng tin th∆∞·ªùng d√πng m√† kh√¥ng c·∫ßn populate\r\n */\r\ninterface ICustomerShortInfo {\r\n  _id: mongoose.Types.ObjectId;\r\n  shortName: string;\r\n}\r\n\r\nexport interface ICustomerCare extends Document {\r\n  careId: string;\r\n  customerId?: string; // D·∫°ng string (n·∫øu b·∫°n v·∫´n mu·ªën d√πng song song)\r\n  customerRef?: mongoose.Types.ObjectId; // Reference chu·∫©n ƒë·ªÉ join n·∫øu c·∫ßn\r\n  customerInfo?: ICustomerShortInfo; // D·ªØ li·ªáu nh√∫ng ƒë·ªÉ truy v·∫•n c·ª±c nhanh\r\n  employeeId?: string;\r\n  opportunityRef?: mongoose.Types.ObjectId;\r\n  careType:\r\n    | \"T∆∞ v·∫•n ‚Äì Kh·∫£o s√°t\"\r\n    | \"L√†m r√µ b√°o gi√° / h·ª£p ƒë·ªìng\"\r\n    | \"Tri·ªÉn khai ‚Äì Theo d√µi\"\r\n    | \"X·ª≠ l√Ω c√¥ng n·ª£\"\r\n    | \"H·∫≠u m√£i ‚Äì ChƒÉm s√≥c ƒë·ªãnh k·ª≥\";\r\n  timeFrom?: Date;\r\n  timeTo?: Date;\r\n  method: \"Online\" | \"Tr·ª±c ti·∫øp\";\r\n  location?: string;\r\n  carePerson: string;\r\n  actualCareDate?: Date;\r\n  images?: string[];\r\n  files?: (string | { url: string; name: string; format?: string })[];\r\n  interestedServices?: string[];\r\n  careResult?: string;\r\n  careResultClassification?: string; // X·∫øp lo·∫°i: ƒê·∫°t, Kh√¥ng ƒë·∫°t, Ch∆∞a r√µ, v.v.\r\n  careClassification?: string;\r\n  discussionContent?: string;\r\n  needsNote?: string;\r\n  status: \"Ho√†n th√†nh\" | \"Ch·ªù b√°o c√°o\" | \"H·ªßy\";\r\n  quotationRef?: mongoose.Types.ObjectId;\r\n  quotationNo?: string;\r\n  surveyRef?: mongoose.Types.ObjectId;\r\n  surveyNo?: string;\r\n  createdAt?: Date;\r\n  updatedAt?: Date;\r\n}\r\n\r\nconst CustomerCareSchema: Schema = new Schema(\r\n  {\r\n    careId: {\r\n      type: String,\r\n      required: true,\r\n      unique: true,\r\n      trim: true,\r\n    },\r\n    // ID kh√°ch h√†ng d·∫°ng string\r\n    customerId: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    // Reference chu·∫©n ƒë·∫øn collection Customers\r\n    customerRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"Customer\",\r\n    },\r\n    // TH√îNG TIN NH√öNG: ƒê√¢y l√† m·∫•u ch·ªët ƒë·ªÉ b·∫°n l·∫•y shortName nhanh\r\n    customerInfo: {\r\n      _id: { type: mongoose.Schema.Types.ObjectId, ref: \"Customer\" },\r\n      shortName: { type: String, trim: true },\r\n    },\r\n    employeeId: {\r\n      type: String,\r\n      trim: true,\r\n    },\r\n    opportunityRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"Opportunity\",\r\n    },\r\n    careType: {\r\n      type: String,\r\n      enum: [\r\n        \"T∆∞ v·∫•n ‚Äì Kh·∫£o s√°t\",\r\n        \"L√†m r√µ b√°o gi√° / h·ª£p ƒë·ªìng\",\r\n        \"Tri·ªÉn khai ‚Äì Theo d√µi\",\r\n        \"X·ª≠ l√Ω c√¥ng n·ª£\",\r\n        \"H·∫≠u m√£i ‚Äì ChƒÉm s√≥c ƒë·ªãnh k·ª≥\",\r\n      ],\r\n      default: \"T∆∞ v·∫•n ‚Äì Kh·∫£o s√°t\",\r\n    },\r\n    timeFrom: { type: Date },\r\n    timeTo: { type: Date },\r\n    method: {\r\n      type: String,\r\n      enum: [\"Online\", \"Tr·ª±c ti·∫øp\"],\r\n      default: \"Online\",\r\n    },\r\n    location: { type: String, trim: true },\r\n    carePerson: {\r\n      type: String,\r\n      required: true,\r\n      trim: true,\r\n    },\r\n    actualCareDate: { type: Date },\r\n    images: [{ type: String, trim: true }],\r\n    files: [{ type: Schema.Types.Mixed }],\r\n    interestedServices: [{ type: String, trim: true }],\r\n    careResult: { type: String, trim: true },\r\n    careResultClassification: { type: String, trim: true },\r\n    careClassification: { type: String, trim: true },\r\n    discussionContent: { type: String, trim: true },\r\n    needsNote: { type: String, trim: true },\r\n    status: {\r\n      type: String,\r\n      enum: [\"Ho√†n th√†nh\", \"Ch·ªù b√°o c√°o\", \"H·ªßy\"],\r\n      default: \"Ch·ªù b√°o c√°o\",\r\n    },\r\n    quotationRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"BaoGia\",\r\n    },\r\n    quotationNo: { type: String, trim: true },\r\n    surveyRef: {\r\n      type: mongoose.Schema.Types.ObjectId,\r\n      ref: \"PROJECT_SURVEY\",\r\n    },\r\n    surveyNo: { type: String, trim: true },\r\n  },\r\n  {\r\n    timestamps: true,\r\n    // T√™n collection c√≥ d·∫•u th∆∞·ªùng g√¢y kh√≥ khƒÉn ·ªü m·ªôt s·ªë m√¥i tr∆∞·ªùng qu·∫£n l√Ω database,\r\n    // nh∆∞ng t√¥i gi·ªØ nguy√™n theo √Ω b·∫°n.\r\n    collection: \"ChƒÉm s√≥c kh√°ch h√†ng\",\r\n  },\r\n);\r\n\r\n// Index ƒë·ªÉ t√¨m ki·∫øm theo t√™n kh√°ch h√†ng nh√∫ng nhanh h∆°n\r\nCustomerCareSchema.index({ \"customerInfo.shortName\": \"text\" });\r\nCustomerCareSchema.index({ customerRef: 1 });\r\n\r\nexport default mongoose.models.CustomerCare ||\r\n  mongoose.model<ICustomerCare>(\"CustomerCare\", CustomerCareSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AA+CA,MAAM,qBAA6B,IAAI,kKAAM,CAC3C;IACE,QAAQ;QACN,MAAM;QACN,UAAU;QACV,QAAQ;QACR,MAAM;IACR;IACA,4BAA4B;IAC5B,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,2CAA2C;IAC3C,aAAa;QACX,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,8DAA8D;IAC9D,cAAc;QACZ,KAAK;YAAE,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;YAAE,KAAK;QAAW;QAC7D,WAAW;YAAE,MAAM;YAAQ,MAAM;QAAK;IACxC;IACA,YAAY;QACV,MAAM;QACN,MAAM;IACR;IACA,gBAAgB;QACd,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,UAAU;QACR,MAAM;QACN,MAAM;YACJ;YACA;YACA;YACA;YACA;SACD;QACD,SAAS;IACX;IACA,UAAU;QAAE,MAAM;IAAK;IACvB,QAAQ;QAAE,MAAM;IAAK;IACrB,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAU;SAAY;QAC7B,SAAS;IACX;IACA,UAAU;QAAE,MAAM;QAAQ,MAAM;IAAK;IACrC,YAAY;QACV,MAAM;QACN,UAAU;QACV,MAAM;IACR;IACA,gBAAgB;QAAE,MAAM;IAAK;IAC7B,QAAQ;QAAC;YAAE,MAAM;YAAQ,MAAM;QAAK;KAAE;IACtC,OAAO;QAAC;YAAE,MAAM,kKAAM,CAAC,KAAK,CAAC,KAAK;QAAC;KAAE;IACrC,oBAAoB;QAAC;YAAE,MAAM;YAAQ,MAAM;QAAK;KAAE;IAClD,YAAY;QAAE,MAAM;QAAQ,MAAM;IAAK;IACvC,0BAA0B;QAAE,MAAM;QAAQ,MAAM;IAAK;IACrD,oBAAoB;QAAE,MAAM;QAAQ,MAAM;IAAK;IAC/C,mBAAmB;QAAE,MAAM;QAAQ,MAAM;IAAK;IAC9C,WAAW;QAAE,MAAM;QAAQ,MAAM;IAAK;IACtC,QAAQ;QACN,MAAM;QACN,MAAM;YAAC;YAAc;YAAe;SAAM;QAC1C,SAAS;IACX;IACA,cAAc;QACZ,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,aAAa;QAAE,MAAM;QAAQ,MAAM;IAAK;IACxC,WAAW;QACT,MAAM,mKAAQ,CAAC,MAAM,CAAC,KAAK,CAAC,QAAQ;QACpC,KAAK;IACP;IACA,UAAU;QAAE,MAAM;QAAQ,MAAM;IAAK;AACvC,GACA;IACE,YAAY;IACZ,kFAAkF;IAClF,mCAAmC;IACnC,YAAY;AACd;AAGF,wDAAwD;AACxD,mBAAmB,KAAK,CAAC;IAAE,0BAA0B;AAAO;AAC5D,mBAAmB,KAAK,CAAC;IAAE,aAAa;AAAE;uCAE3B,mKAAQ,CAAC,MAAM,CAAC,YAAY,IACzC,mKAAQ,CAAC,KAAK,CAAgB,gBAAgB"}},
    {"offset": {"line": 552, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/Service.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface IService extends Document {\r\n    name: string;\r\n    code: string;\r\n    serviceGroup: string;\r\n    description?: string;\r\n    active: boolean;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nconst ServiceSchema: Schema = new Schema(\r\n    {\r\n        serviceName: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        code: {\r\n            type: String,\r\n            required: true,\r\n            unique: true,\r\n            uppercase: true,\r\n            trim: true,\r\n        },\r\n        serviceGroup: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        description: {\r\n            type: String,\r\n            trim: true,\r\n        },\r\n        isActive: {\r\n            type: Boolean,\r\n            default: true,\r\n        },\r\n    },\r\n    {\r\n        timestamps: true,\r\n        collection: \"D·ªãch v·ª•\",\r\n    },\r\n);\r\n\r\nexport default mongoose.models.Service ||\r\n    mongoose.model<IService>(\"Service\", ServiceSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAYA,MAAM,gBAAwB,IAAI,kKAAM,CACpC;IACI,aAAa;QACT,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,MAAM;QACF,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACV;IACA,cAAc;QACV,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,aAAa;QACT,MAAM;QACN,MAAM;IACV;IACA,UAAU;QACN,MAAM;QACN,SAAS;IACb;AACJ,GACA;IACI,YAAY;IACZ,YAAY;AAChB;uCAGW,mKAAQ,CAAC,MAAM,CAAC,OAAO,IAClC,mKAAQ,CAAC,KAAK,CAAW,WAAW"}},
    {"offset": {"line": 593, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/models/SourceSetting.ts"],"sourcesContent":["import mongoose, { Schema, Document } from \"mongoose\";\r\n\r\nexport interface ISourceSetting extends Document {\r\n    name: string;\r\n    code: string;\r\n    active: boolean;\r\n    createdAt?: Date;\r\n    updatedAt?: Date;\r\n}\r\n\r\nconst SourceSettingSchema: Schema = new Schema(\r\n    {\r\n        name: {\r\n            type: String,\r\n            required: true,\r\n            trim: true,\r\n        },\r\n        code: {\r\n            type: String,\r\n            required: true,\r\n            unique: true,\r\n            uppercase: true,\r\n            trim: true,\r\n        },\r\n        active: {\r\n            type: Boolean,\r\n            default: true,\r\n        },\r\n    },\r\n    {\r\n        timestamps: true,\r\n        collection: \"source_settings\",\r\n    },\r\n);\r\n\r\nexport default mongoose.models.SourceSetting ||\r\n    mongoose.model<ISourceSetting>(\"SourceSetting\", SourceSettingSchema);\r\n"],"names":[],"mappings":";;;;AAAA;;AAUA,MAAM,sBAA8B,IAAI,kKAAM,CAC1C;IACI,MAAM;QACF,MAAM;QACN,UAAU;QACV,MAAM;IACV;IACA,MAAM;QACF,MAAM;QACN,UAAU;QACV,QAAQ;QACR,WAAW;QACX,MAAM;IACV;IACA,QAAQ;QACJ,MAAM;QACN,SAAS;IACb;AACJ,GACA;IACI,YAAY;IACZ,YAAY;AAChB;uCAGW,mKAAQ,CAAC,MAAM,CAAC,aAAa,IACxC,mKAAQ,CAAC,KAAK,CAAiB,iBAAiB"}},
    {"offset": {"line": 625, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/app/api/stats/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport dbConnect from \"../../../lib/dbConnect\";\r\nimport Customer from \"../../../models/Customer\";\r\nimport Employee from \"../../../models/Employee\";\r\nimport Quotation from \"../../../models/Quotation\";\r\nimport CustomerCare from \"../../../models/CustomerCare\";\r\nimport Service from \"../../../models/Service\";\r\nimport SourceSetting from \"../../../models/SourceSetting\";\r\n\r\nexport async function GET() {\r\n    try {\r\n        await dbConnect();\r\n        console.log(\"üîÑ Fetching dashboard stats...\");\r\n\r\n        // Get counts for all collections\r\n        const [\r\n            customers,\r\n            employees,\r\n            quotations,\r\n            customerCare,\r\n            services,\r\n            sourceSettings,\r\n        ] = await Promise.all([\r\n            Customer.countDocuments(),\r\n            Employee.countDocuments(),\r\n            Quotation.countDocuments(),\r\n            CustomerCare.countDocuments(),\r\n            Service.countDocuments(),\r\n            SourceSetting.countDocuments(),\r\n        ]);\r\n\r\n        console.log(\"‚úÖ Dashboard stats fetched successfully\");\r\n\r\n        return NextResponse.json({\r\n            success: true,\r\n            data: {\r\n                customers,\r\n                employees,\r\n                quotations,\r\n                customerCare,\r\n                services,\r\n                sourceSettings,\r\n            },\r\n        });\r\n    } catch (error) {\r\n        console.error(\"‚ùå Error fetching dashboard stats:\", error);\r\n        return NextResponse.json(\r\n            { success: false, error: \"Failed to fetch dashboard stats\" },\r\n            { status: 500 },\r\n        );\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;AAEO,eAAe;IAClB,IAAI;QACA,MAAM,IAAA,6HAAS;QACf,QAAQ,GAAG,CAAC;QAEZ,iCAAiC;QACjC,MAAM,CACF,WACA,WACA,YACA,cACA,UACA,eACH,GAAG,MAAM,QAAQ,GAAG,CAAC;YAClB,+HAAQ,CAAC,cAAc;YACvB,+HAAQ,CAAC,cAAc;YACvB,gIAAS,CAAC,cAAc;YACxB,mIAAY,CAAC,cAAc;YAC3B,8HAAO,CAAC,cAAc;YACtB,oIAAa,CAAC,cAAc;SAC/B;QAED,QAAQ,GAAG,CAAC;QAEZ,OAAO,gJAAY,CAAC,IAAI,CAAC;YACrB,SAAS;YACT,MAAM;gBACF;gBACA;gBACA;gBACA;gBACA;gBACA;YACJ;QACJ;IACJ,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qCAAqC;QACnD,OAAO,gJAAY,CAAC,IAAI,CACpB;YAAE,SAAS;YAAO,OAAO;QAAkC,GAC3D;YAAE,QAAQ;QAAI;IAEtB;AACJ"}}]
}