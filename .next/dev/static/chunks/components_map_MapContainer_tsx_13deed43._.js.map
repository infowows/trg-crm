{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///D:/WOWS_Test/trg-crm/components/map/MapContainer.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useRef, useState, useCallback } from \"react\";\r\nimport dynamic from \"next/dynamic\";\r\nimport { MapPin, RefreshCw } from \"lucide-react\";\r\n\r\n// Dynamic import for Leaflet to avoid SSR issues\r\nconst LeafletMap = dynamic(\r\n    () =>\r\n        import(\"react-leaflet\").then((mod) => {\r\n            const {\r\n                MapContainer: LeafletMapContainer,\r\n                TileLayer,\r\n                useMap,\r\n                useMapEvents,\r\n            } = mod;\r\n            const L = require(\"leaflet\");\r\n\r\n            // Fix Leaflet's default icon\r\n            delete (L.Icon.Default.prototype as any)._getIconUrl;\r\n            L.Icon.Default.mergeOptions({\r\n                iconRetinaUrl:\r\n                    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon-2x.png\",\r\n                iconUrl:\r\n                    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-icon.png\",\r\n                shadowUrl:\r\n                    \"https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/images/marker-shadow.png\",\r\n            });\r\n\r\n            // Component to handle map events and expose map instance\r\n            const MapEventHandler = ({ onBoundsChanged, setMapRef }: any) => {\r\n                const map = useMap();\r\n\r\n                useEffect(() => {\r\n                    if (setMapRef) {\r\n                        setMapRef(map);\r\n                    }\r\n                }, [map, setMapRef]);\r\n\r\n                useMapEvents({\r\n                    moveend: () => {\r\n                        if (onBoundsChanged) {\r\n                            const bounds = map.getBounds();\r\n                            onBoundsChanged(bounds);\r\n                        }\r\n                    },\r\n                    zoomend: () => {\r\n                        if (onBoundsChanged) {\r\n                            const bounds = map.getBounds();\r\n                            onBoundsChanged(bounds);\r\n                        }\r\n                    },\r\n                });\r\n\r\n                return null;\r\n            };\r\n\r\n            // Component to update map view when center changes\r\n            const MapViewController = ({ center }: any) => {\r\n                const map = useMap();\r\n\r\n                useEffect(() => {\r\n                    if (center) {\r\n                        map.setView([center.lat, center.lng], map.getZoom());\r\n                    }\r\n                }, [center, map]);\r\n\r\n                return null;\r\n            };\r\n\r\n            return function MapContainerComponent({\r\n                customers,\r\n                viewMode,\r\n                selectedCustomer,\r\n                onMarkerClick,\r\n                onViewDetail,\r\n                onBoundsChanged,\r\n                setMapRef,\r\n                center,\r\n                loading,\r\n            }: any) {\r\n                const [mapReady, setMapReady] = useState(false);\r\n\r\n                useEffect(() => {\r\n                    setMapReady(true);\r\n                }, []);\r\n\r\n                if (!mapReady) {\r\n                    return (\r\n                        <div className=\"flex items-center justify-center h-full\">\r\n                            <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                        </div>\r\n                    );\r\n                }\r\n\r\n                return (\r\n                    <LeafletMapContainer\r\n                        center={[center.lat, center.lng]}\r\n                        zoom={12}\r\n                        style={{ height: \"100%\", width: \"100%\" }}\r\n                    >\r\n                        <TileLayer\r\n                            url=\"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\"\r\n                            attribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors'\r\n                        />\r\n                        <MapEventHandler\r\n                            onBoundsChanged={onBoundsChanged}\r\n                            setMapRef={setMapRef}\r\n                        />\r\n                        <MapViewController center={center} />\r\n\r\n                        {/* Markers will be added here */}\r\n                        {customers.map((customer: any) => {\r\n                            const lat = parseFloat(customer.lat.toString());\r\n                            const lng = parseFloat(customer.lng.toString());\r\n\r\n                            if (isNaN(lat) || isNaN(lng)) return null;\r\n\r\n                            const markerColor = getMarkerColor(customer);\r\n\r\n                            const customIcon = L.divIcon({\r\n                                className: \"custom-marker-icon\",\r\n                                html: `\r\n                                <div style=\"\r\n                                    background-color: ${markerColor};\r\n                                    width: 24px;\r\n                                    height: 24px;\r\n                                    border-radius: 50% 50% 50% 0;\r\n                                    transform: rotate(-45deg);\r\n                                    border: 2px solid white;\r\n                                    box-shadow: 0 2px 5px rgba(0,0,0,0.3);\r\n                                \">\r\n                                    <div style=\"\r\n                                        width: 8px;\r\n                                        height: 8px;\r\n                                        background-color: white;\r\n                                        border-radius: 50%;\r\n                                        position: absolute;\r\n                                        top: 50%;\r\n                                        left: 50%;\r\n                                        transform: translate(-50%, -50%);\r\n                                    \"></div>\r\n                                </div>\r\n                            `,\r\n                                iconSize: [24, 24],\r\n                                iconAnchor: [12, 24],\r\n                                popupAnchor: [0, -24],\r\n                            });\r\n\r\n                            return (\r\n                                <L.Marker\r\n                                    key={customer._id}\r\n                                    position={[lat, lng]}\r\n                                    icon={customIcon}\r\n                                    eventHandlers={{\r\n                                        click: () => onMarkerClick(customer),\r\n                                    }}\r\n                                >\r\n                                    <L.Popup>\r\n                                        <div\r\n                                            className=\"p-2\"\r\n                                            style={{\r\n                                                minWidth: \"280px\",\r\n                                                maxWidth: \"320px\",\r\n                                            }}\r\n                                        >\r\n                                            <div className=\"flex items-start gap-3 mb-3\">\r\n                                                <div\r\n                                                    style={{\r\n                                                        flex: 1,\r\n                                                        minWidth: 0,\r\n                                                    }}\r\n                                                >\r\n                                                    <h3\r\n                                                        style={{\r\n                                                            fontWeight: \"bold\",\r\n                                                            fontSize: \"16px\",\r\n                                                            color: \"#111827\",\r\n                                                        }}\r\n                                                    >\r\n                                                        {customer.fullName}\r\n                                                    </h3>\r\n                                                    {customer.companyName && (\r\n                                                        <p\r\n                                                            style={{\r\n                                                                fontSize:\r\n                                                                    \"12px\",\r\n                                                                color: \"#6b7280\",\r\n                                                            }}\r\n                                                        >\r\n                                                            {\r\n                                                                customer.companyName\r\n                                                            }\r\n                                                        </p>\r\n                                                    )}\r\n                                                </div>\r\n                                            </div>\r\n                                            <div\r\n                                                style={{\r\n                                                    marginBottom: \"12px\",\r\n                                                    fontSize: \"12px\",\r\n                                                }}\r\n                                            >\r\n                                                {customer.address && (\r\n                                                    <div\r\n                                                        style={{\r\n                                                            display: \"flex\",\r\n                                                            gap: \"8px\",\r\n                                                            marginBottom: \"8px\",\r\n                                                        }}\r\n                                                    >\r\n                                                        <span\r\n                                                            style={{\r\n                                                                color: \"#f59e0b\",\r\n                                                            }}\r\n                                                        >\r\n                                                            üìç\r\n                                                        </span>\r\n                                                        <span\r\n                                                            style={{\r\n                                                                color: \"#374151\",\r\n                                                                lineHeight:\r\n                                                                    \"1.4\",\r\n                                                            }}\r\n                                                        >\r\n                                                            {customer.address}\r\n                                                        </span>\r\n                                                    </div>\r\n                                                )}\r\n                                                <div\r\n                                                    style={{\r\n                                                        display: \"flex\",\r\n                                                        alignItems: \"center\",\r\n                                                        gap: \"16px\",\r\n                                                    }}\r\n                                                >\r\n                                                    {customer.potentialLevel && (\r\n                                                        <div\r\n                                                            style={{\r\n                                                                display: \"flex\",\r\n                                                                alignItems:\r\n                                                                    \"center\",\r\n                                                                gap: \"4px\",\r\n                                                            }}\r\n                                                        >\r\n                                                            <span\r\n                                                                style={{\r\n                                                                    color: \"#f59e0b\",\r\n                                                                }}\r\n                                                            >\r\n                                                                ‚≠ê\r\n                                                            </span>\r\n                                                            <span\r\n                                                                style={{\r\n                                                                    color: \"#374151\",\r\n                                                                }}\r\n                                                            >\r\n                                                                {\r\n                                                                    customer.potentialLevel\r\n                                                                }\r\n                                                            </span>\r\n                                                        </div>\r\n                                                    )}\r\n                                                    <span\r\n                                                        style={{\r\n                                                            padding: \"2px 8px\",\r\n                                                            borderRadius: \"4px\",\r\n                                                            fontSize: \"12px\",\r\n                                                            fontWeight: \"500\",\r\n                                                            backgroundColor:\r\n                                                                customer.status ===\r\n                                                                \"customer\"\r\n                                                                    ? \"#10b981\"\r\n                                                                    : \"#f59e0b\",\r\n                                                            color: \"white\",\r\n                                                        }}\r\n                                                    >\r\n                                                        {customer.status ===\r\n                                                        \"customer\"\r\n                                                            ? \"Kh√°ch h√†ng\"\r\n                                                            : \"Ti·ªÅm nƒÉng\"}\r\n                                                    </span>\r\n                                                </div>\r\n                                            </div>\r\n                                            <div\r\n                                                style={{\r\n                                                    display: \"flex\",\r\n                                                    gap: \"8px\",\r\n                                                }}\r\n                                            >\r\n                                                <button\r\n                                                    onClick={() =>\r\n                                                        onViewDetail(customer)\r\n                                                    }\r\n                                                    style={{\r\n                                                        padding: \"6px 12px\",\r\n                                                        backgroundColor:\r\n                                                            \"#3b82f6\",\r\n                                                        color: \"white\",\r\n                                                        border: \"none\",\r\n                                                        borderRadius: \"4px\",\r\n                                                        fontSize: \"12px\",\r\n                                                        cursor: \"pointer\",\r\n                                                    }}\r\n                                                >\r\n                                                    Xem chi ti·∫øt\r\n                                                </button>\r\n                                            </div>\r\n                                        </div>\r\n                                    </L.Popup>\r\n                                </L.Marker>\r\n                            );\r\n                        })}\r\n                    </LeafletMapContainer>\r\n                );\r\n            };\r\n        }),\r\n    { ssr: false },\r\n);\r\n\r\n// Helper function to get marker color based on customer status\r\nfunction getMarkerColor(customer: any) {\r\n    if (customer.status === \"customer\") {\r\n        return \"#10b981\"; // green-500\r\n    }\r\n    if (customer.potentialLevel && customer.potentialLevel.length >= 4) {\r\n        return \"#f59e0b\"; // amber-500\r\n    }\r\n    return \"#6b7280\"; // gray-500\r\n}\r\n\r\ninterface Customer {\r\n    _id: string;\r\n    fullName: string;\r\n    companyName?: string;\r\n    address?: string;\r\n    lat?: number;\r\n    lng?: number;\r\n    phone?: string;\r\n    email?: string;\r\n    source?: string;\r\n    potentialLevel?: string;\r\n    salesPerson?: string;\r\n    status?: string;\r\n    createdAt: string;\r\n    updatedAt: string;\r\n}\r\n\r\ninterface MapContainerProps {\r\n    customers: Customer[];\r\n    viewMode: \"cluster\" | \"heatmap\";\r\n    selectedCustomer: Customer | null;\r\n    onMarkerClick: (customer: Customer) => void;\r\n    onViewDetail: (customer: Customer) => void;\r\n    onBoundsChanged: (bounds: any) => void;\r\n    setMapRef: (ref: any) => void;\r\n    center: { lat: number; lng: number };\r\n    loading: boolean;\r\n}\r\n\r\nconst MapContainer = (props: MapContainerProps) => {\r\n    return (\r\n        <div className=\"w-full h-full relative\">\r\n            {props.loading && (\r\n                <div className=\"absolute inset-0 bg-white bg-opacity-75 flex items-center justify-center z-10\">\r\n                    <div className=\"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600\"></div>\r\n                </div>\r\n            )}\r\n            <LeafletMap {...props} />\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default MapContainer;\r\n"],"names":[],"mappings":"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"}}]
}